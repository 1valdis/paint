{"version":3,"sources":["components/helpers.ts","components/Modal/Modal.tsx","actions/types.ts","actions/colors.ts","components/FileMenu/about/About.tsx","components/FileMenu/FileMenu.tsx","actions/instruments.ts","actions/app.ts","components/ResizerPoint/ResizerPoint.tsx","components/Resizer/Resizer.tsx","components/MovableSelection/MovableSelection.tsx","components/instruments/SelectionInstrument/ZoneSelection/ZoneSelection.tsx","components/instruments/SelectionInstrument/ImageDataSelection/ImageDataSelection.tsx","components/instruments/SelectionInstrument/SelectionInstrument.tsx","actions/selection.ts","components/instruments/Pen/Pen.tsx","components/instruments/Fill/Fill.tsx","components/instruments/Dropper/Dropper.tsx","components/instruments/Eraser/Eraser.tsx","components/CanvasEditor/CanvasEditor.tsx","components/Canvas/Canvas.tsx","components/NavBar/NavBar.tsx","components/NavBar/NavBarItem.tsx","components/Clipboard/Clipboard.tsx","components/Image/Image.tsx","components/instruments/Instruments.tsx","components/ColorPalette/ColorPalette.tsx","components/ColorSelection/ColorSelection.tsx","components/ColorInput/ColorInput.tsx","components/Color/Color.tsx","components/Colors/ColorsComponent.tsx","components/Colors/ColorsContainer.tsx","components/App/App.tsx","reducers/instruments.ts","reducers/index.ts","reducers/colors.ts","index.tsx"],"names":["isVisible","elem","offsetWidth","offsetHeight","getClientRects","length","componentToHex","c","hex","toString","rgbToHex","r","g","b","bresenhamLine","x0","y0","x1","y1","callback","dx","Math","abs","dy","sx","sy","err","e2","getCanvasCoordsFromEvent","canvas","e","getBoundingClientRect","top","left","clientX","clientY","mouseX","mouseY","floor","Modal","props","element","document","createElement","classList","add","createPortal","this","children","root","appendChild","removeChild","PureComponent","getElementById","ActionTypes","SelectedColor","About","className","onClick","onClose","href","title","FileMenu","menu","clickOutsideListener","toggleMenu","setState","state","menuOpen","closeMenu","openAbout","aboutOpen","closeAbout","createRef","ref","classNames","onFileCreate","type","accept","onChange","onFileOpen","onDownload","current","outsideClickListener","event","contains","target","addEventListener","addClickOutsideListener","listener","removeEventListener","Instruments","selectColor","index","selectInstrument","instrument","changeInstrument","ctx","getContext","alpha","Error","changeImage","imageData","dispatch","getState","width","height","putImageData","data","clearCanvas","fillStyle","fillRect","ResizerDirections","ResizerMode","ResizerPoint","resizing","preventContextMenu","resizerElement","handlePointerDown","button","onResizeStart","onResizeCancel","handlePointerUp","onResizeEnd","handlePointerMove","buttons","onResizeMove","handlePointerCancel","handleDragStart","preventDefault","handleContextMenu","style","outerStyle","innerStyle","passive","window","Component","directions","se","s","selection","n","ne","sw","w","nw","Resizer","resizeRect","resizeTop","resizeLeft","resizeWidth","resizeHeight","resizer_resizing","hideBorderOnResizing","mode","map","d","key","direction","bottom","right","parentRect","parentNode","pageYOffset","pageXOffset","round","onResizing","nextProps","prevState","MovableSelection","currentTarget","moving","startX","startY","handleDocumentPointerMove","onMoving","coords","onMoveEnd","handleDocumentPointerUp","withoutOnChange","onPointerDown","getDerivedStateFromProps","ZoneSelection","canvasRef","oldCtx","newCtx","backgroundColor","handleResizing","handleResizeEnd","secondaryColor","onCoordsChanged","onImageChanged","getImageData","handleMoving","handleMoveEnd","redrawCanvas","updateOld","imageSmoothingEnabled","drawImage","originCoords","onClickOutside","oldCanvas","undefined","ImageDataSelection","selectionCtx","resized","updateOldCanvas","updateSelectionCanvas","selectionCanvas","selectionImageData","updateNewCanvas","changeSelection","resizeCanvasToFitPasted","max","prevProps","_SelectionInstrument","containerRef","trusted","ceil","selecting","selectingY","selectingX","selectingCoords","trunc","canvasRelativeTop","canvasRelativeLeft","min","selectionOriginCoords","El","selectionCoords","zone","SelectionInstrument","connect","image","instruments","colors","list","secondary","_Pen","isDrawing","prevX","prevY","x","y","beginDrawing","continueDrawing","handlePointerEnter","handlePointerLeave","endDrawing","cancelDrawing","handleDocumentContextMenu","handleDocumentSelectStart","color","drawPoint","onPointerMove","onPointerEnter","onPointerLeave","Pen","primary","_Fill","handleMouseDown","floodFill","colorToReplace","colorToFillWith","replaceR","replaceG","replaceB","fillR","fillG","fillB","i","q","push","shift","onMouseDown","Fill","_Dropper","handleClick","addColor","pen","Dropper","newColor","findIndex","value","_Eraser","noCursorCtx","updateCanvas","thickness","updateCanvasNoCursor","strokeRect","strokeStyle","fill","dropper","eraser","CanvasEditor","Element","Canvas","onResize","toWidth","toHeight","newCanvas","disableSelection","NavBar","NavBarItem","footer","Clipboard","disabled","_Image","handleClipClick","select_active","viewBox","strokeWidth","strokeDasharray","stroke","Image","Object","values","InstrumentsList","filter","instrument_active","ColorPalette","ColorSelection","active","header","ColorInput","Color","color_active","color_undefined","ColorsComponent","activeColor","onActiveColorClick","onColorClick","Array","item","onColorInputChange","_ColorsContainer","ColorsContainer","changeActiveColor","hexRgb","match","rgb","v","parseInt","find","addColorFromInput","_App","Fragment","name","downloadName","toBlob","blob","URL","revokeObjectURL","createObjectURL","a","download","body","click","onPaste","App","input","nativeEvent","file","files","reader","FileReader","onload","img","src","result","readAsDataURL","openFile","clipboardData","items","indexOf","getAsFile","source","pastedImage","pastedImageCanvas","pastedImageCtx","paste","reducer","combineReducers","action","canvasEl","newState","slice","withoutType","composeEnhancers","__REDUX_DEVTOOLS_EXTENSION_COMPOSE__","compose","store","createStore","applyMiddleware","thunk","render"],"mappings":"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","file":"static/js/main.514bbf9c.chunk.js","sourcesContent":["import {\r\n  PointerEvent as ReactPointerEvent,\r\n  MouseEvent as ReactMouseEvent\r\n} from 'react'\r\n\r\nexport interface ClickOutsideListener {\r\n  (event: MouseEvent): void\r\n}\r\n\r\nexport function addClickOutsideListener(\r\n  element: HTMLElement,\r\n  callback: ClickOutsideListener\r\n) {\r\n  const outsideClickListener = (event: MouseEvent) => {\r\n    if (!element.contains(event.target as HTMLElement)) {\r\n      if (isVisible(element)) {\r\n        callback(event)\r\n      }\r\n    }\r\n  }\r\n\r\n  document.addEventListener('click', outsideClickListener)\r\n  return outsideClickListener\r\n}\r\n\r\nexport function removeClickOutsideListener(listener: ClickOutsideListener) {\r\n  document.removeEventListener('click', listener)\r\n}\r\n\r\nconst isVisible = (elem: HTMLElement) =>\r\n  !!elem &&\r\n  !!(elem.offsetWidth || elem.offsetHeight || elem.getClientRects().length)\r\n\r\nfunction componentToHex(c: number) {\r\n  const hex = c.toString(16)\r\n  return hex.length === 1 ? '0' + hex : hex\r\n}\r\n\r\nexport function rgbToHex({ r, g, b }: { r: number; g: number; b: number }) {\r\n  return '#' + componentToHex(r) + componentToHex(g) + componentToHex(b)\r\n}\r\n\r\nexport function bresenhamLine(\r\n  x0: number,\r\n  y0: number,\r\n  x1: number,\r\n  y1: number,\r\n  callback: (x: number, y: number) => void\r\n) {\r\n  const dx = Math.abs(x1 - x0)\r\n  const dy = Math.abs(y1 - y0)\r\n  const sx = x0 < x1 ? 1 : -1\r\n  const sy = y0 < y1 ? 1 : -1\r\n  let err = dx - dy\r\n\r\n  while (true) {\r\n    callback(x0, y0)\r\n\r\n    if (x0 === x1 && y0 === y1) break\r\n    var e2 = 2 * err\r\n    if (e2 > -dy) {\r\n      err -= dy\r\n      x0 += sx\r\n    }\r\n    if (e2 < dx) {\r\n      err += dx\r\n      y0 += sy\r\n    }\r\n  }\r\n}\r\n\r\nexport function getCanvasCoordsFromEvent(\r\n  canvas: HTMLCanvasElement,\r\n  e: ReactPointerEvent<HTMLCanvasElement> | PointerEvent | ReactMouseEvent\r\n) {\r\n  const { top, left } = canvas.getBoundingClientRect()\r\n  const [mouseX, mouseY] = [e.clientX, e.clientY]\r\n  return [Math.floor(mouseX - left), Math.floor(mouseY - top)]\r\n}\r\n","import { PureComponent } from 'react'\r\nimport { createPortal } from 'react-dom'\r\n\r\nimport './Modal.css'\r\n\r\nexport interface ModalProps {}\r\n\r\nexport class Modal extends PureComponent<ModalProps> {\r\n  element: Element\r\n\r\n  static root = document.getElementById('modal-root')\r\n\r\n  constructor(props: ModalProps) {\r\n    super(props)\r\n    this.element = document.createElement('div')\r\n    this.element.classList.add('modal')\r\n  }\r\n\r\n  render() {\r\n    return createPortal(this.props.children, this.element)\r\n  }\r\n\r\n  componentDidMount() {\r\n    Modal.root && Modal.root.appendChild(this.element)\r\n  }\r\n\r\n  componentWillUnmount() {\r\n    Modal.root && Modal.root.removeChild(this.element)\r\n  }\r\n}\r\n","import {\r\n  AddColorAction,\r\n  SelectColorAction,\r\n  ChangeSelectedColorAction\r\n} from './colors'\r\nimport { ChangeInstrumentAction } from './instruments'\r\nimport { ChangeImageAction } from './app'\r\n\r\nexport enum ActionTypes {\r\n  addColor,\r\n  selectColor,\r\n  changeActiveColor,\r\n  changeInstrument,\r\n  changeImage\r\n}\r\n\r\nexport type Action =\r\n  | AddColorAction\r\n  | SelectColorAction\r\n  | ChangeSelectedColorAction\r\n  | ChangeInstrumentAction\r\n  | ChangeImageAction\r\n","import { ActionTypes } from './types'\r\nimport { ChangeEvent } from 'react'\r\nimport { ThunkAction } from 'redux-thunk'\r\nimport { StoreState } from '../reducers'\r\n\r\nexport interface Color {\r\n  r: number\r\n  g: number\r\n  b: number\r\n}\r\n\r\nexport enum SelectedColor {\r\n  primary = 'primary',\r\n  secondary = 'secondary'\r\n}\r\n\r\nexport interface AddColorAction {\r\n  type: ActionTypes.addColor\r\n  value: Color\r\n}\r\n\r\nexport interface SelectColorAction {\r\n  type: ActionTypes.selectColor\r\n  index: number\r\n}\r\n\r\nexport interface ChangeSelectedColorAction {\r\n  type: ActionTypes.changeActiveColor\r\n  activeColor: SelectedColor\r\n}\r\n\r\nexport const changeActiveColor = (\r\n  activeColor: SelectedColor\r\n): ChangeSelectedColorAction => {\r\n  return {\r\n    type: ActionTypes.changeActiveColor,\r\n    activeColor\r\n  }\r\n}\r\n\r\nexport const addColorFromInput = (\r\n  e: ChangeEvent<HTMLInputElement>\r\n): ThunkAction<void, StoreState, undefined, AddColorAction> => {\r\n  return (dispatch, getState): void => {\r\n    const hexRgb = e.target.value.match(/[A-Za-z0-9]{2}/g)\r\n    if (!hexRgb) return\r\n    const rgb = hexRgb.map(v => parseInt(v, 16))\r\n    const newColor: Color = { r: rgb[0], g: rgb[1], b: rgb[2] }\r\n    const colors = getState().colors.list\r\n    if (\r\n      !colors.find(\r\n        color =>\r\n          color.r === newColor.r &&\r\n          color.g === newColor.g &&\r\n          color.b === newColor.b\r\n      )\r\n    ) {\r\n      dispatch<AddColorAction>({\r\n        type: ActionTypes.addColor,\r\n        value: newColor\r\n      })\r\n    }\r\n  }\r\n}\r\n\r\nexport const addColor = (\r\n  newColor: Color\r\n): ThunkAction<\r\n  void,\r\n  StoreState,\r\n  undefined,\r\n  AddColorAction | SelectColorAction\r\n> => {\r\n  return (dispatch, getState) => {\r\n    const colors = getState().colors.list\r\n    const index = colors.findIndex(\r\n      color =>\r\n        color.r === newColor.r &&\r\n        color.g === newColor.g &&\r\n        color.b === newColor.b\r\n    )\r\n    if (index === -1) {\r\n      dispatch<AddColorAction>({\r\n        type: ActionTypes.addColor,\r\n        value: newColor\r\n      })\r\n    } else {\r\n      dispatch<SelectColorAction>(selectColor(index))\r\n    }\r\n  }\r\n}\r\n\r\nexport const selectColor = (index: number): SelectColorAction => {\r\n  return {\r\n    type: ActionTypes.selectColor,\r\n    index\r\n  }\r\n}\r\n","import React, { FunctionComponent, MouseEventHandler } from 'react'\r\n\r\nimport './About.css'\r\n\r\nexport interface AboutProps {\r\n  onClose: MouseEventHandler\r\n}\r\n\r\nexport const About: FunctionComponent<AboutProps> = props => (\r\n  <div className=\"about\">\r\n    <button className=\"about-close-button\" onClick={props.onClose} />\r\n    <p>Greetings, stranger.</p>\r\n    <div>\r\n      Icons made by{' '}\r\n      <a href=\"https://www.flaticon.com/authors/good-ware\" title=\"Good Ware\">\r\n        Good Ware\r\n      </a>\r\n      ,{' '}\r\n      <a href=\"https://www.flaticon.com/authors/smashicons\" title=\"Smashicons\">\r\n        Smashicons\r\n      </a>\r\n      ,{' '}\r\n      <a\r\n        href=\"https://www.flaticon.com/authors/pixel-buddha\"\r\n        title=\"Pixel Buddha\">\r\n        Pixel Buddha\r\n      </a>\r\n      ,{' '}\r\n      <a href=\"http://www.freepik.com\" title=\"Freepik\">\r\n        Freepik\r\n      </a>\r\n      ,{' '}\r\n      <a\r\n        href=\"https://www.flaticon.com/authors/dimitry-miroliubov\"\r\n        title=\"Dimitry Miroliubov\">\r\n        Dimitry Miroliubov\r\n      </a>{' '}\r\n      from{' '}\r\n      <a href=\"https://www.flaticon.com/\" title=\"Flaticon\">\r\n        www.flaticon.com\r\n      </a>{' '}\r\n      is licensed by{' '}\r\n      <a\r\n        href=\"http://creativecommons.org/licenses/by/3.0/\"\r\n        title=\"Creative Commons BY 3.0\">\r\n        CC 3.0 BY\r\n      </a>\r\n    </div>\r\n  </div>\r\n)\r\n","import React, {\r\n  PureComponent,\r\n  createRef,\r\n  MouseEventHandler,\r\n  RefObject,\r\n  ChangeEventHandler\r\n} from 'react'\r\n\r\nimport './FileMenu.css'\r\n\r\nimport classNames from 'classnames'\r\n\r\nimport {\r\n  addClickOutsideListener,\r\n  removeClickOutsideListener,\r\n  ClickOutsideListener\r\n} from '../helpers'\r\n\r\nimport { Modal } from '../Modal/Modal'\r\nimport { About } from './about/About'\r\n\r\nexport interface FileMenuProps {\r\n  onDownload: MouseEventHandler\r\n  onFileCreate: MouseEventHandler\r\n  onFileOpen: ChangeEventHandler\r\n}\r\n\r\ninterface FileMenuState {\r\n  menuOpen: boolean\r\n  aboutOpen: boolean\r\n}\r\n\r\nexport class FileMenu extends PureComponent<FileMenuProps, FileMenuState> {\r\n  menu: RefObject<HTMLDivElement>\r\n\r\n  clickOutsideListener?: ClickOutsideListener\r\n\r\n  constructor(props: FileMenuProps) {\r\n    super(props)\r\n    this.menu = createRef()\r\n    this.state = { menuOpen: false, aboutOpen: false }\r\n  }\r\n\r\n  render() {\r\n    return (\r\n      <div\r\n        ref={this.menu}\r\n        className={classNames('file-menu', {\r\n          'file-menu_open': this.state.menuOpen\r\n        })}>\r\n        <button className=\"file-menu-button\" onClick={this.toggleMenu}>\r\n          File\r\n        </button>\r\n        <nav className=\"file-menu-items\" onClick={this.closeMenu}>\r\n          <button className=\"file-menu-item\" onClick={this.props.onFileCreate}>\r\n            Create\r\n          </button>\r\n          <label className=\"file-menu-item\">\r\n            Open\r\n            <input\r\n              type=\"file\"\r\n              className=\"file-menu-item\"\r\n              accept=\"image/*\"\r\n              onChange={this.props.onFileOpen}\r\n            />\r\n          </label>\r\n          <button className=\"file-menu-item\" onClick={this.props.onDownload}>\r\n            Save\r\n          </button>\r\n          <button className=\"file-menu-item\" onClick={this.openAbout}>\r\n            About...\r\n          </button>\r\n        </nav>\r\n        {this.state.aboutOpen && (\r\n          <Modal>\r\n            <About onClose={this.closeAbout} />\r\n          </Modal>\r\n        )}\r\n      </div>\r\n    )\r\n  }\r\n\r\n  componentDidMount() {\r\n    if (this.menu.current)\r\n      this.clickOutsideListener = addClickOutsideListener(\r\n        this.menu.current,\r\n        this.closeMenu\r\n      )\r\n  }\r\n\r\n  componentWillUnmount() {\r\n    if (this.clickOutsideListener)\r\n      removeClickOutsideListener(this.clickOutsideListener)\r\n  }\r\n\r\n  toggleMenu = () => this.setState(state => ({ menuOpen: !state.menuOpen }))\r\n\r\n  closeMenu = () => this.setState({ menuOpen: false })\r\n\r\n  openAbout = () => this.setState({ aboutOpen: true })\r\n\r\n  closeAbout = () => this.setState({ aboutOpen: false })\r\n}\r\n","import { ActionTypes } from './types'\r\n\r\nexport enum Instruments {\r\n  pen = 'pen',\r\n  fill = 'fill',\r\n  text = 'text',\r\n  eraser = 'eraser',\r\n  dropper = 'dropper',\r\n  zoom = 'zoom',\r\n  selection = 'selection'\r\n}\r\n\r\nexport interface ChangeInstrumentAction {\r\n  type: ActionTypes.changeInstrument\r\n  instrument?: Instruments\r\n  selection?: any // todo fix\r\n}\r\n\r\nexport const selectInstrument = (\r\n  instrument: Instruments\r\n): ChangeInstrumentAction => {\r\n  return {\r\n    type: ActionTypes.changeInstrument,\r\n    instrument\r\n  }\r\n}\r\n","import { ActionTypes } from './types'\r\nimport { ThunkAction } from 'redux-thunk'\r\nimport { StoreState } from '../reducers'\r\nimport { ChangeEvent } from 'react'\r\nimport { ChangeInstrumentAction, Instruments } from './instruments'\r\n\r\nexport interface ChangeImageAction {\r\n  type: ActionTypes.changeImage\r\n  data: ImageData\r\n  name?: string\r\n}\r\n\r\nconst canvas = document.createElement('canvas')\r\n\r\nconst ctx = canvas.getContext('2d', { alpha: false })\r\nif (!ctx) throw new Error(\"Coudn't acquire context\")\r\n\r\nlet href: string\r\n\r\nexport const createFile = (): ThunkAction<\r\n  void,\r\n  StoreState,\r\n  undefined,\r\n  ChangeImageAction\r\n> => {\r\n  return function(dispatch) {\r\n    ;[canvas.width, canvas.height] = [800, 450]\r\n    clearCanvas()\r\n    dispatch({\r\n      type: ActionTypes.changeImage,\r\n      data: ctx.getImageData(0, 0, canvas.width, canvas.height),\r\n      name: 'Ваша пикча.png'\r\n    })\r\n  }\r\n}\r\n\r\nexport const openFile = (\r\n  e: ChangeEvent<HTMLInputElement>\r\n): ThunkAction<void, StoreState, undefined, ChangeImageAction> => {\r\n  return function(dispatch) {\r\n    const input = e.nativeEvent.currentTarget as HTMLInputElement\r\n    const file = input.files && input.files[0]\r\n    if (file == null) return\r\n    const reader = new FileReader()\r\n    reader.onload = e => {\r\n      const img = new Image()\r\n      img.onload = () => {\r\n        canvas.width = img.width\r\n        canvas.height = img.height\r\n        ctx.drawImage(img, 0, 0)\r\n        dispatch({\r\n          type: ActionTypes.changeImage,\r\n          data: ctx.getImageData(0, 0, img.width, img.height),\r\n          name: file.name\r\n        })\r\n      }\r\n      img.src = (e.currentTarget as FileReader).result as string\r\n    }\r\n    reader.readAsDataURL(file)\r\n  }\r\n}\r\n\r\nexport function paste(\r\n  e: ClipboardEvent\r\n): ThunkAction<void, StoreState, undefined, ChangeInstrumentAction> {\r\n  return function(dispatch) {\r\n    if (e.clipboardData) {\r\n      const items = e.clipboardData.items\r\n      if (!items) return\r\n\r\n      for (let i = 0; i < items.length; i++) {\r\n        if (items[i].type.indexOf('image') !== -1) {\r\n          const blob = items[i].getAsFile()\r\n          const source = window.URL.createObjectURL(blob)\r\n          const pastedImage = new Image()\r\n          pastedImage.onload = () => {\r\n            const pastedImageCanvas = document.createElement('canvas')\r\n            pastedImageCanvas.width = pastedImage.width\r\n            pastedImageCanvas.height = pastedImage.height\r\n            const pastedImageCtx = pastedImageCanvas.getContext('2d')\r\n            if (!pastedImageCtx) throw new Error(\"Coudn't acquire context\")\r\n            pastedImageCtx.drawImage(pastedImage, 0, 0)\r\n\r\n            dispatch({\r\n              type: ActionTypes.changeInstrument,\r\n              instrument: Instruments.selection,\r\n              selection: {\r\n                imageData: pastedImageCtx.getImageData(\r\n                  0,\r\n                  0,\r\n                  pastedImageCanvas.width,\r\n                  pastedImageCanvas.height\r\n                ),\r\n                coords: {\r\n                  top: 0,\r\n                  left: 0,\r\n                  width: pastedImage.width,\r\n                  height: pastedImage.height\r\n                }\r\n              }\r\n            })\r\n          }\r\n          pastedImage.src = source\r\n          break\r\n        }\r\n      }\r\n      e.preventDefault()\r\n    }\r\n  }\r\n}\r\n\r\nexport const changeImage = (\r\n  imageData: ImageData\r\n): ThunkAction<void, StoreState, undefined, ChangeImageAction> => {\r\n  return function(dispatch, getState) {\r\n    canvas.width = imageData.width\r\n    canvas.height = imageData.height\r\n    ctx.putImageData(imageData, 0, 0)\r\n    dispatch({\r\n      type: ActionTypes.changeImage,\r\n      data: imageData\r\n    })\r\n  }\r\n}\r\n\r\nexport const clearCanvas = () => {\r\n  ctx.fillStyle = '#FFFFFF'\r\n  ctx.fillRect(0, 0, canvas.width, canvas.height)\r\n}\r\n\r\nexport const download = (name: string) => {\r\n  canvas.toBlob(blob => {\r\n    if (href !== null) {\r\n      window.URL.revokeObjectURL(href)\r\n    }\r\n    href = window.URL.createObjectURL(blob)\r\n    const a = document.createElement('a')\r\n    a.download = name\r\n    a.href = href\r\n    document.body.appendChild(a)\r\n    a.click()\r\n    document.body.removeChild(a)\r\n  })\r\n}\r\n","import React, { Component, createRef, RefObject, CSSProperties } from 'react'\r\nimport './ResizerPoint.css'\r\n\r\nexport interface ResizerPointProps {\r\n  outerStyle?: CSSProperties\r\n  innerStyle?: CSSProperties\r\n  className: string\r\n  onResizeStart: (e: PointerEvent) => void\r\n  onResizeMove: (e: PointerEvent) => void\r\n  onResizeEnd: (e: PointerEvent) => void\r\n  onResizeCancel: (e: Event) => void\r\n}\r\n\r\nexport class ResizerPoint extends Component<ResizerPointProps> {\r\n  resizing = false\r\n\r\n  preventContextMenu = false\r\n\r\n  resizerElement: RefObject<HTMLDivElement> = createRef()\r\n\r\n  render() {\r\n    return (\r\n      <div\r\n        className={'resizer-outer ' + (this.props.className || '')}\r\n        style={{ ...this.props.outerStyle }}\r\n        ref={this.resizerElement}>\r\n        <div className=\"resizer-inner\" style={{ ...this.props.innerStyle }} />\r\n      </div>\r\n    )\r\n  }\r\n\r\n  componentDidMount() {\r\n    document.addEventListener('pointerdown', this.handlePointerDown, {\r\n      passive: true\r\n    })\r\n    document.addEventListener('pointermove', this.handlePointerMove, {\r\n      passive: true\r\n    })\r\n    document.addEventListener('pointerup', this.handlePointerUp, {\r\n      passive: true\r\n    })\r\n    document.addEventListener('pointercancel', this.handlePointerCancel, {\r\n      passive: true\r\n    })\r\n    window.addEventListener('blur', this.handlePointerCancel, { passive: true })\r\n    document.addEventListener('contextmenu', this.handleContextMenu)\r\n    document.addEventListener('dragstart', this.handleDragStart)\r\n  }\r\n\r\n  componentWillUnmount() {\r\n    document.removeEventListener('pointerdown', this.handlePointerDown)\r\n    document.removeEventListener('pointermove', this.handlePointerMove)\r\n    document.removeEventListener('pointerup', this.handlePointerUp)\r\n    document.removeEventListener('pointercancel', this.handlePointerCancel)\r\n    window.removeEventListener('blur', this.handlePointerCancel)\r\n    document.removeEventListener('contextmenu', this.handleContextMenu)\r\n    document.removeEventListener('dragstart', this.handleDragStart)\r\n  }\r\n\r\n  handlePointerDown = (e: PointerEvent) => {\r\n    if (!this.resizerElement.current)\r\n      throw new Error('The ref contains no resizer element')\r\n    switch (e.button) {\r\n      case 0:\r\n        if (this.resizerElement.current.contains(e.target as Node | null)) {\r\n          this.resizing = true\r\n          this.props.onResizeStart(e)\r\n        }\r\n        return\r\n      case 2:\r\n        this.resizing = false\r\n        this.props.onResizeCancel(e)\r\n        break\r\n      default:\r\n        break\r\n    }\r\n  }\r\n\r\n  handlePointerUp = (e: PointerEvent) => {\r\n    if (this.resizing) {\r\n      this.props.onResizeEnd(e)\r\n      this.resizing = false\r\n    }\r\n  }\r\n\r\n  handlePointerMove = (e: PointerEvent) => {\r\n    if (this.resizing) {\r\n      switch (e.buttons) {\r\n        case 1:\r\n          this.props.onResizeMove(e)\r\n          break\r\n        case 2:\r\n        case 3:\r\n          this.resizing = false\r\n          this.props.onResizeCancel(e)\r\n          this.preventContextMenu = true\r\n          break\r\n        default:\r\n          break\r\n      }\r\n    }\r\n  }\r\n\r\n  handlePointerCancel = (e: Event) => {\r\n    if (this.resizing) {\r\n      this.resizing = false\r\n      this.props.onResizeCancel(e)\r\n    }\r\n  }\r\n\r\n  handleDragStart = (e: Event) => {\r\n    e.preventDefault()\r\n  }\r\n\r\n  handleContextMenu = (e: Event) => {\r\n    if (this.preventContextMenu) {\r\n      e.preventDefault()\r\n      this.preventContextMenu = false\r\n    }\r\n  }\r\n}\r\n","import React, { PureComponent, createRef, RefObject } from 'react'\r\n\r\nimport './Resizer.css'\r\n\r\nimport classNames from 'classnames'\r\n\r\nimport { ResizerPoint } from '../ResizerPoint/ResizerPoint'\r\n\r\nexport enum ResizerDirections {\r\n  n = 'n',\r\n  ne = 'ne',\r\n  e = 'e',\r\n  se = 'se',\r\n  s = 's',\r\n  sw = 'sw',\r\n  w = 'w',\r\n  nw = 'nw'\r\n}\r\n\r\nexport enum ResizerMode {\r\n  canvas,\r\n  selection\r\n}\r\n\r\nconst directions = {\r\n  [ResizerMode.canvas]: [\r\n    ResizerDirections.e,\r\n    ResizerDirections.se,\r\n    ResizerDirections.s\r\n  ],\r\n  [ResizerMode.selection]: [\r\n    ResizerDirections.n,\r\n    ResizerDirections.ne,\r\n    ResizerDirections.e,\r\n    ResizerDirections.se,\r\n    ResizerDirections.s,\r\n    ResizerDirections.sw,\r\n    ResizerDirections.w,\r\n    ResizerDirections.nw\r\n  ]\r\n}\r\n\r\nexport interface ResizerProps {\r\n  top: number\r\n  left: number\r\n  width: number\r\n  height: number\r\n  hideBorderOnResizing?: boolean\r\n  mode: ResizerMode\r\n  onResizing?: (\r\n    top: number,\r\n    left: number,\r\n    width: number,\r\n    height: number\r\n  ) => void\r\n  onResizeEnd?: (\r\n    top: number,\r\n    left: number,\r\n    width: number,\r\n    height: number\r\n  ) => void\r\n}\r\n\r\nexport interface ResizerState {\r\n  resizing: boolean\r\n  resizeTop: number\r\n  resizeLeft: number\r\n  resizeWidth: number\r\n  resizeHeight: number\r\n}\r\n\r\nexport class Resizer extends PureComponent<ResizerProps, ResizerState> {\r\n  resizeRect: RefObject<HTMLDivElement> = createRef()\r\n\r\n  constructor(props: ResizerProps) {\r\n    super(props)\r\n    this.state = {\r\n      resizing: false,\r\n      resizeTop: this.props.top,\r\n      resizeLeft: this.props.left,\r\n      resizeWidth: this.props.width,\r\n      resizeHeight: this.props.height\r\n    }\r\n  }\r\n\r\n  render() {\r\n    return (\r\n      <div\r\n        className={classNames('resizer', {\r\n          resizer_resizing: this.state.resizing,\r\n          'resizer_hide-border': this.props.hideBorderOnResizing\r\n        })}\r\n        ref={this.resizeRect}\r\n        style={{\r\n          width: `${\r\n            this.state.resizing ? this.state.resizeWidth : this.props.width\r\n          }px`,\r\n          height: `${\r\n            this.state.resizing ? this.state.resizeHeight : this.props.height\r\n          }px`,\r\n          top: `${\r\n            this.state.resizing ? this.state.resizeTop : this.props.top\r\n          }px`,\r\n          left: `${\r\n            this.state.resizing ? this.state.resizeLeft : this.props.left\r\n          }px`\r\n        }}>\r\n        {directions[this.props.mode].map(d => (\r\n          <ResizerPoint\r\n            onResizeStart={e => this.onResizeStart()}\r\n            onResizeMove={e => this.onResizeMove(d, e)}\r\n            onResizeEnd={e => this.onResizeEnd()}\r\n            onResizeCancel={e => this.onResizeCancel()}\r\n            key={`${d}-resizer-point`}\r\n            className={d}\r\n          />\r\n        ))}\r\n      </div>\r\n    )\r\n  }\r\n\r\n  onResizeStart() {}\r\n\r\n  onResizeMove(direction: ResizerDirections, e: PointerEvent) {\r\n    if (!this.resizeRect.current)\r\n      throw new Error('The ref contains no rect element')\r\n    let {\r\n      top,\r\n      left,\r\n      bottom,\r\n      right\r\n    } = this.resizeRect.current.getBoundingClientRect()\r\n    const parentRect = (this.resizeRect.current\r\n      .parentNode as Element).getBoundingClientRect()\r\n    ;[top, left, bottom, right] = [\r\n      top + window.pageYOffset,\r\n      left + window.pageXOffset,\r\n      bottom + window.pageYOffset,\r\n      right + window.pageXOffset\r\n    ]\r\n    const [mouseX, mouseY] = [\r\n      e.clientX + window.pageXOffset,\r\n      e.clientY + window.pageYOffset\r\n    ]\r\n\r\n    const state = {\r\n      resizing: true,\r\n      resizeTop: this.props.top,\r\n      resizeLeft: this.props.left,\r\n      resizeWidth: this.props.width,\r\n      resizeHeight: this.props.height\r\n    }\r\n\r\n    switch (direction) {\r\n      case ResizerDirections.n:\r\n        state.resizeTop = mouseY - parentRect.top\r\n        state.resizeHeight = this.props.height - state.resizeTop\r\n        break\r\n      case ResizerDirections.ne:\r\n        state.resizeTop = mouseY - parentRect.top\r\n        state.resizeHeight = this.props.height - state.resizeTop\r\n        state.resizeWidth = mouseX - left\r\n        break\r\n      case ResizerDirections.e:\r\n        state.resizeWidth = mouseX - left\r\n        break\r\n      case ResizerDirections.se:\r\n        state.resizeHeight = mouseY - top\r\n        state.resizeWidth = mouseX - left\r\n        break\r\n      case ResizerDirections.s:\r\n        state.resizeHeight = mouseY - top\r\n        break\r\n      case ResizerDirections.sw:\r\n        state.resizeHeight = mouseY - top\r\n        state.resizeLeft = mouseX - parentRect.left\r\n        state.resizeWidth = this.props.width - state.resizeLeft\r\n        break\r\n      case ResizerDirections.w:\r\n        state.resizeLeft = mouseX - parentRect.left\r\n        state.resizeWidth = this.props.width - state.resizeLeft\r\n        break\r\n      case ResizerDirections.nw:\r\n        state.resizeTop = mouseY - parentRect.top\r\n        state.resizeHeight = this.props.height - state.resizeTop\r\n        state.resizeLeft = mouseX - parentRect.left\r\n        state.resizeWidth = this.props.width - state.resizeLeft\r\n        break\r\n    }\r\n\r\n    state.resizeTop = Math.round(\r\n      state.resizeTop + window.pageYOffset >\r\n        this.props.top + this.props.height - 1\r\n        ? this.props.height + this.props.top - 1\r\n        : state.resizeTop\r\n    )\r\n    state.resizeLeft = Math.round(\r\n      state.resizeLeft + window.pageXOffset >\r\n        this.props.left + this.props.width - 1\r\n        ? this.props.width + this.props.left - 1\r\n        : state.resizeLeft\r\n    )\r\n    state.resizeWidth = Math.round(\r\n      state.resizeWidth > 0 ? state.resizeWidth : 1\r\n    )\r\n    state.resizeHeight = Math.round(\r\n      state.resizeHeight > 0 ? state.resizeHeight : 1\r\n    )\r\n    if (this.props.onResizing) {\r\n      this.props.onResizing(\r\n        state.resizeTop,\r\n        state.resizeLeft,\r\n        state.resizeWidth,\r\n        state.resizeHeight\r\n      )\r\n    }\r\n    this.setState(state)\r\n  }\r\n\r\n  onResizeEnd() {\r\n    if (this.props.onResizeEnd) {\r\n      this.props.onResizeEnd(\r\n        this.state.resizeTop,\r\n        this.state.resizeLeft,\r\n        this.state.resizeWidth,\r\n        this.state.resizeHeight\r\n      )\r\n    }\r\n    this.setState({ resizing: false })\r\n  }\r\n\r\n  onResizeCancel() {\r\n    this.setState({\r\n      resizing: false,\r\n      resizeWidth: this.props.width,\r\n      resizeHeight: this.props.height\r\n    })\r\n  }\r\n\r\n  static getDerivedStateFromProps(\r\n    nextProps: ResizerProps,\r\n    prevState = { resizing: false }\r\n  ) {\r\n    return prevState.resizing\r\n      ? null\r\n      : {\r\n          resizeTop: nextProps.top,\r\n          resizeLeft: nextProps.left,\r\n          resizeWidth: nextProps.width,\r\n          resizeHeight: nextProps.height\r\n        }\r\n  }\r\n}\r\n","import React, { PureComponent, PointerEvent as ReactPointerEvent } from 'react'\r\n\r\nimport './MovableSelection.css'\r\n\r\nimport { Resizer, ResizerMode } from '../Resizer/Resizer'\r\nimport { SelectionCoords } from '../../actions'\r\n\r\nexport interface MovableSelectionProps {\r\n  top: number\r\n  left: number\r\n  width: number\r\n  height: number\r\n  hideBorderOnResizing: boolean\r\n  onResizeEnd: (coords: SelectionCoords) => void\r\n  onResizing: (coords: SelectionCoords) => void\r\n  onMoveEnd: (coords: SelectionCoords) => void\r\n  onMoving: (coords: SelectionCoords) => void\r\n}\r\n\r\nexport interface MovableSelectionState {\r\n  moving: boolean\r\n  startX: number | null\r\n  startY: number | null\r\n  left: number\r\n  top: number\r\n}\r\n\r\nexport class MovableSelection extends PureComponent<\r\n  MovableSelectionProps,\r\n  MovableSelectionState\r\n> {\r\n  preventContextMenu: boolean = false\r\n\r\n  constructor(props: MovableSelectionProps) {\r\n    super(props)\r\n    this.state = {\r\n      moving: false,\r\n      startX: null,\r\n      startY: null,\r\n      left: this.props.left,\r\n      top: this.props.top\r\n    }\r\n  }\r\n\r\n  render() {\r\n    const {\r\n      onResizeEnd,\r\n      onResizing,\r\n      onMoveEnd,\r\n      onMoving,\r\n      ...withoutOnChange\r\n    } = this.props\r\n    return (\r\n      <div\r\n        style={this.props}\r\n        onPointerDown={this.handlePointerDown}\r\n        className=\"movable-selection\">\r\n        <Resizer mode={ResizerMode.selection} {...withoutOnChange} onResizing={this.onResizing} onResizeEnd={this.onResizeEnd} top={0} left={0} />\r\n      </div>\r\n    )\r\n  }\r\n\r\n  onResizeEnd = (top: number, left: number, width: number, height: number) => {\r\n    this.props.onResizeEnd({\r\n      top: this.props.top + top,\r\n      left: this.props.left + left,\r\n      width,\r\n      height\r\n    })\r\n  }\r\n\r\n  onResizing = (top: number, left: number, width: number, height: number) => {\r\n    this.props.onResizing({\r\n      top: this.props.top + top,\r\n      left: this.props.left + left,\r\n      width,\r\n      height\r\n    })\r\n  }\r\n\r\n  handlePointerDown = (e: ReactPointerEvent<HTMLDivElement>) => {\r\n    if (e.target === e.currentTarget) {\r\n      this.setState({\r\n        moving: true,\r\n        startX: e.clientX + window.pageXOffset,\r\n        startY: e.clientY + window.pageYOffset\r\n      })\r\n    }\r\n  }\r\n\r\n  handleDocumentPointerMove = (e: PointerEvent) => {\r\n    if (\r\n      this.state.moving &&\r\n      this.state.startX !== null &&\r\n      this.state.startY !== null &&\r\n      this.props.onMoving\r\n    ) {\r\n      switch (e.buttons) {\r\n        case 1:\r\n          const {\r\n            onResizeEnd,\r\n            onResizing,\r\n            onMoveEnd,\r\n            onMoving,\r\n            ...coords\r\n          } = this.props\r\n          coords.top =\r\n            this.state.top +\r\n            (e.clientY + window.pageYOffset - this.state.startY)\r\n          coords.left =\r\n            this.state.left +\r\n            (e.clientX + window.pageXOffset - this.state.startX)\r\n          this.props.onMoving(coords)\r\n          break\r\n        case 2:\r\n        case 3:\r\n          this.props.onMoving({\r\n            top: this.state.top,\r\n            left: this.state.left,\r\n            width: this.props.width,\r\n            height: this.props.height\r\n          })\r\n          this.setState({\r\n            moving: false\r\n          })\r\n          this.preventContextMenu = true\r\n          break\r\n      }\r\n    }\r\n  }\r\n\r\n  handleDocumentPointerUp = (e: PointerEvent) => {\r\n    if (\r\n      this.state.moving &&\r\n      this.state.startX !== null &&\r\n      this.state.startY !== null &&\r\n      this.props.onMoving\r\n    ) {\r\n      const {\r\n        onResizeEnd,\r\n        onResizing,\r\n        onMoveEnd,\r\n        onMoving,\r\n        ...coords\r\n      } = this.props\r\n      coords.top =\r\n        this.state.top + (e.clientY + window.pageYOffset - this.state.startY)\r\n      coords.left =\r\n        this.state.left + (e.clientX + window.pageXOffset - this.state.startX)\r\n      this.props.onMoveEnd(coords)\r\n    }\r\n    this.setState({\r\n      moving: false,\r\n      startX: null,\r\n      startY: null\r\n    })\r\n  }\r\n\r\n  static getDerivedStateFromProps = (props: MovableSelectionProps, state: MovableSelectionState) => {\r\n    if (!state.moving) {\r\n      return {\r\n        top: props.top,\r\n        left: props.left\r\n      }\r\n    }\r\n    return null\r\n  }\r\n\r\n  componentDidMount() {\r\n    document.addEventListener('pointermove', this.handleDocumentPointerMove, {\r\n      passive: true\r\n    })\r\n    document.addEventListener('pointerup', this.handleDocumentPointerUp, {\r\n      passive: true\r\n    })\r\n    document.addEventListener('contextmenu', this.handleContextMenu)\r\n  }\r\n\r\n  componentWillUnmount() {\r\n    document.removeEventListener('pointermove', this.handleDocumentPointerUp)\r\n    document.removeEventListener('pointerup', this.handleDocumentPointerUp)\r\n    document.removeEventListener('contextmenu', this.handleContextMenu)\r\n  }\r\n\r\n  handleContextMenu = (e: Event) => {\r\n    if (this.preventContextMenu) {\r\n      e.preventDefault()\r\n      this.preventContextMenu = false\r\n    }\r\n  }\r\n}\r\n","import React, {\r\n  PureComponent,\r\n  Fragment,\r\n  createRef,\r\n  RefObject,\r\n  PointerEvent as ReactPointerEvent\r\n} from 'react'\r\n\r\nimport { MovableSelection } from '../../../MovableSelection/MovableSelection'\r\nimport { SelectionCoords, Color } from '../../../../actions'\r\n\r\ninterface ZoneSelectionProps {\r\n  coords: SelectionCoords\r\n  secondaryColor: Color\r\n  imageData: ImageData\r\n  onCoordsChanged: (newCoords: SelectionCoords) => void\r\n  onImageChanged: (newImageData: ImageData) => void\r\n  onClickOutside: (e: ReactPointerEvent<HTMLCanvasElement>) => void\r\n}\r\n\r\ninterface ZoneSelectionState {\r\n  originCoords: SelectionCoords\r\n}\r\n\r\nexport class ZoneSelection extends PureComponent<\r\n  ZoneSelectionProps,\r\n  ZoneSelectionState\r\n> {\r\n  canvasRef: RefObject<HTMLCanvasElement> = createRef()\r\n\r\n  oldCtx?: CanvasRenderingContext2D\r\n\r\n  newCtx?: CanvasRenderingContext2D\r\n\r\n  backgroundColor?: Color\r\n\r\n  constructor(props: ZoneSelectionProps) {\r\n    super(props)\r\n\r\n    this.state = {\r\n      originCoords: this.props.coords\r\n    }\r\n  }\r\n\r\n  render() {\r\n    return (\r\n      <Fragment>\r\n        <canvas\r\n          ref={this.canvasRef}\r\n          onPointerDown={e =>\r\n            e.target === e.currentTarget && this.props.onClickOutside(e)\r\n          }\r\n        />\r\n        <MovableSelection\r\n          {...this.props.coords}\r\n          onResizing={this.handleResizing}\r\n          onResizeEnd={this.handleResizeEnd}\r\n          onMoving={this.handleMoving}\r\n          onMoveEnd={this.handleMoveEnd}\r\n          hideBorderOnResizing={false}\r\n        />\r\n      </Fragment>\r\n    )\r\n  }\r\n\r\n  componentDidMount() {\r\n    const oldCanvas = document.createElement('canvas')\r\n    oldCanvas.width = this.props.imageData.width\r\n    oldCanvas.height = this.props.imageData.height\r\n    this.oldCtx = oldCanvas.getContext('2d') || undefined\r\n    if (!this.oldCtx) throw new Error(\"Coudn't acquire context\")\r\n    this.oldCtx.putImageData(this.props.imageData, 0, 0)\r\n\r\n    if (!this.canvasRef.current) throw new Error(\"Canvas didn't mount\")\r\n    this.canvasRef.current.width = this.props.imageData.width\r\n    this.canvasRef.current.height = this.props.imageData.height\r\n    this.newCtx = this.canvasRef.current.getContext('2d') || undefined\r\n\r\n    if (!this.newCtx) throw new Error(\"Coudn't acquire context\")\r\n    this.newCtx.imageSmoothingEnabled = false\r\n  }\r\n\r\n  handleResizing = ({ top, left, width, height }: SelectionCoords) => {}\r\n\r\n  handleResizeEnd = ({ top, left, width, height }: SelectionCoords) => {\r\n    if (!this.newCtx) throw new Error(\"Coudn't acquire context\")\r\n    if (!this.backgroundColor) {\r\n      this.backgroundColor = this.props.secondaryColor\r\n      this.newCtx.fillStyle = `rgb(${this.backgroundColor.r}, ${this.backgroundColor.g}, ${this.backgroundColor.b})`\r\n    }\r\n    this.props.onCoordsChanged({ top, left, width, height })\r\n    this.props.onImageChanged(\r\n      this.newCtx.getImageData(\r\n        0,\r\n        0,\r\n        this.newCtx.canvas.width,\r\n        this.newCtx.canvas.height\r\n      )\r\n    )\r\n  }\r\n\r\n  handleMoving = ({ top, left, width, height }: SelectionCoords) => {\r\n    if (!this.newCtx) throw new Error(\"Coudn't acquire context\")\r\n    if (!this.backgroundColor) {\r\n      this.backgroundColor = this.props.secondaryColor\r\n      this.newCtx.fillStyle = `rgb(${this.backgroundColor.r}, ${this.backgroundColor.g}, ${this.backgroundColor.b})`\r\n    }\r\n    this.props.onCoordsChanged({ top, left, width, height })\r\n  }\r\n\r\n  handleMoveEnd = ({ top, left, width, height }: SelectionCoords) => {\r\n    if (!this.newCtx) throw new Error(\"Coudn't acquire context\")\r\n    this.props.onImageChanged(\r\n      this.newCtx.getImageData(\r\n        0,\r\n        0,\r\n        this.newCtx.canvas.width,\r\n        this.newCtx.canvas.height\r\n      )\r\n    )\r\n  }\r\n\r\n  redrawCanvas = (updateOld: boolean) => {\r\n    if (!this.newCtx || !this.oldCtx) throw new Error(\"Coudn't acquire context\")\r\n    if (updateOld) {\r\n      this.oldCtx.canvas.width = this.props.imageData.width\r\n      this.oldCtx.canvas.height = this.props.imageData.height\r\n      this.newCtx.canvas.width = this.props.imageData.width\r\n      this.newCtx.canvas.height = this.props.imageData.height\r\n      this.newCtx.imageSmoothingEnabled = false\r\n      this.oldCtx.putImageData(this.props.imageData, 0, 0)\r\n    }\r\n\r\n    this.newCtx.drawImage(this.oldCtx.canvas, 0, 0)\r\n\r\n    if (this.props.coords && this.state.originCoords) {\r\n      this.newCtx.fillRect(\r\n        this.state.originCoords.left,\r\n        this.state.originCoords.top,\r\n        this.state.originCoords.width,\r\n        this.state.originCoords.height\r\n      )\r\n      this.newCtx.drawImage(\r\n        this.oldCtx.canvas,\r\n        this.state.originCoords.left,\r\n        this.state.originCoords.top,\r\n        this.state.originCoords.width,\r\n        this.state.originCoords.height,\r\n        this.props.coords.left,\r\n        this.props.coords.top,\r\n        this.props.coords.width,\r\n        this.props.coords.height\r\n      )\r\n    }\r\n  }\r\n\r\n  componentDidUpdate() {\r\n    this.redrawCanvas(false)\r\n  }\r\n}\r\n","import React, {\r\n  PureComponent,\r\n  Fragment,\r\n  createRef,\r\n  RefObject,\r\n  PointerEvent as ReactPointerEvent\r\n} from 'react'\r\n\r\nimport { MovableSelection } from '../../../MovableSelection/MovableSelection'\r\nimport { SelectionCoords, Color } from '../../../../actions'\r\n\r\nexport interface ImageDataSelectionProps {\r\n  imageData: ImageData\r\n  coords: SelectionCoords\r\n  selectionImageData: ImageData\r\n  secondaryColor: Color\r\n  changeSelection: (data: {\r\n    coords?: SelectionCoords | null\r\n    imageData?: ImageData | null\r\n  }) => void\r\n  changeImage: (imageData: ImageData) => void\r\n  onClickOutside: (e: ReactPointerEvent<HTMLCanvasElement>) => void\r\n}\r\n\r\nexport class ImageDataSelection extends PureComponent<ImageDataSelectionProps> {\r\n  canvasRef: RefObject<HTMLCanvasElement> = createRef()\r\n\r\n  oldCtx?: CanvasRenderingContext2D\r\n\r\n  newCtx?: CanvasRenderingContext2D\r\n\r\n  selectionCtx?: CanvasRenderingContext2D\r\n\r\n  backgroundColor?: Color\r\n\r\n  resized?: boolean\r\n\r\n  updateOld?: boolean\r\n\r\n  constructor(props: ImageDataSelectionProps) {\r\n    super(props)\r\n\r\n    this.canvasRef = createRef()\r\n\r\n    if (\r\n      this.props.imageData.width < this.props.selectionImageData.width ||\r\n      this.props.imageData.height < this.props.selectionImageData.height\r\n    ) {\r\n      this.resized = true\r\n      this.resizeCanvasToFitPasted()\r\n      this.props.changeSelection({\r\n        coords: this.props.coords,\r\n        imageData: this.props.selectionImageData\r\n      })\r\n      this.updateOld = true\r\n    }\r\n  }\r\n\r\n  render() {\r\n    return (\r\n      <Fragment>\r\n        <canvas\r\n          ref={this.canvasRef}\r\n          onPointerDown={e =>\r\n            e.target === e.currentTarget && this.props.onClickOutside(e)\r\n          }\r\n        />\r\n        <MovableSelection\r\n          {...this.props.coords}\r\n          onResizing={this.handleResizing}\r\n          onResizeEnd={this.handleResizeEnd}\r\n          onMoving={this.handleMoving}\r\n          onMoveEnd={this.handleMoveEnd}\r\n          hideBorderOnResizing={false}\r\n        />\r\n      </Fragment>\r\n    )\r\n  }\r\n\r\n  componentDidMount() {\r\n    this.updateOldCanvas()\r\n    this.updateSelectionCanvas()\r\n    this.updateNewCanvas()\r\n    if (!this.newCtx) throw new Error(\"Coudn't acquire context\")\r\n    this.props.changeImage(\r\n      this.newCtx.getImageData(\r\n        0,\r\n        0,\r\n        this.newCtx.canvas.width,\r\n        this.newCtx.canvas.height\r\n      )\r\n    )\r\n  }\r\n\r\n  componentDidUpdate(prevProps: ImageDataSelectionProps) {\r\n    if (this.updateOld) {\r\n      this.updateOldCanvas()\r\n    }\r\n    if (this.props.selectionImageData !== prevProps.selectionImageData) {\r\n      this.updateSelectionCanvas()\r\n    }\r\n    this.updateNewCanvas()\r\n    if (!this.newCtx) throw new Error(\"Coudn't acquire context\")\r\n    if (this.resized) {\r\n      this.resized = false\r\n      this.props.changeImage(\r\n        this.newCtx.getImageData(\r\n          0,\r\n          0,\r\n          this.newCtx.canvas.width,\r\n          this.newCtx.canvas.height\r\n        )\r\n      )\r\n      this.updateOld = false\r\n      return\r\n    }\r\n    this.updateOld = true\r\n    if (this.props.selectionImageData !== prevProps.selectionImageData) {\r\n      this.props.changeImage(\r\n        this.newCtx.getImageData(\r\n          0,\r\n          0,\r\n          this.newCtx.canvas.width,\r\n          this.newCtx.canvas.height\r\n        )\r\n      )\r\n    }\r\n  }\r\n\r\n  updateOldCanvas = () => {\r\n    if (!this.oldCtx) {\r\n      const oldCanvas = document.createElement('canvas')\r\n      this.oldCtx = oldCanvas.getContext('2d') || undefined\r\n    }\r\n    if (!this.oldCtx) throw new Error(\"Coudn't acquire context\")\r\n    this.oldCtx.canvas.width = this.props.imageData.width\r\n    this.oldCtx.canvas.height = this.props.imageData.height\r\n    this.oldCtx.putImageData(this.props.imageData, 0, 0)\r\n  }\r\n\r\n  updateSelectionCanvas = () => {\r\n    if (!this.selectionCtx) {\r\n      const selectionCanvas = document.createElement('canvas')\r\n      this.selectionCtx = selectionCanvas.getContext('2d') || undefined\r\n    }\r\n    if (!this.selectionCtx) throw new Error(\"Coudn't acquire context\")\r\n    this.selectionCtx.canvas.width = this.props.selectionImageData.width\r\n    this.selectionCtx.canvas.height = this.props.selectionImageData.height\r\n    this.selectionCtx.putImageData(this.props.selectionImageData, 0, 0)\r\n  }\r\n\r\n  updateNewCanvas = () => {\r\n    if (!this.selectionCtx || !this.oldCtx)\r\n      throw new Error(\"Coudn't acquire context\")\r\n    if (!this.newCtx) {\r\n      if (!this.canvasRef.current) throw new Error(\"Canvas didn't mount\")\r\n      this.canvasRef.current.width = this.oldCtx.canvas.width\r\n      this.canvasRef.current.height = this.oldCtx.canvas.height\r\n      this.newCtx = this.canvasRef.current.getContext('2d') || undefined\r\n      if (!this.newCtx) throw new Error(\"Coudn't acquire context\")\r\n      this.newCtx.imageSmoothingEnabled = false\r\n    }\r\n\r\n    if (\r\n      this.newCtx.canvas.width !== this.oldCtx.canvas.width ||\r\n      this.newCtx.canvas.height !== this.oldCtx.canvas.height\r\n    ) {\r\n      this.newCtx.canvas.width = this.oldCtx.canvas.width\r\n      this.newCtx.canvas.height = this.oldCtx.canvas.height\r\n      this.newCtx.imageSmoothingEnabled = false\r\n    }\r\n\r\n    this.newCtx.drawImage(this.oldCtx.canvas, 0, 0)\r\n\r\n    this.newCtx.drawImage(\r\n      this.selectionCtx.canvas,\r\n      0,\r\n      0,\r\n      this.selectionCtx.canvas.width,\r\n      this.selectionCtx.canvas.height,\r\n      this.props.coords.left,\r\n      this.props.coords.top,\r\n      this.props.coords.width,\r\n      this.props.coords.height\r\n    )\r\n  }\r\n\r\n  handleResizing = ({ top, left, width, height }: SelectionCoords) => {}\r\n\r\n  handleResizeEnd = ({ top, left, width, height }: SelectionCoords) => {\r\n    if (!this.newCtx) throw new Error(\"Coudn't acquire context\")\r\n    if (!this.backgroundColor) {\r\n      this.backgroundColor = this.props.secondaryColor\r\n      this.newCtx.fillStyle = `rgb(${this.backgroundColor.r}, ${this.backgroundColor.g}, ${this.backgroundColor.b})`\r\n    }\r\n    this.updateOld = false\r\n    this.props.changeSelection({\r\n      coords: { top, left, width, height },\r\n      imageData: this.props.selectionImageData\r\n    })\r\n    this.updateOld = false\r\n    this.props.changeImage(\r\n      this.newCtx.getImageData(\r\n        0,\r\n        0,\r\n        this.newCtx.canvas.width,\r\n        this.newCtx.canvas.height\r\n      )\r\n    )\r\n  }\r\n\r\n  handleMoving = ({ top, left, width, height }: SelectionCoords) => {\r\n    if (!this.backgroundColor) {\r\n      this.backgroundColor = this.props.secondaryColor\r\n      if (!this.newCtx) throw new Error(\"Coudn't acquire context\")\r\n      this.newCtx.fillStyle = `rgb(${this.backgroundColor.r}, ${this.backgroundColor.g}, ${this.backgroundColor.b})`\r\n    }\r\n    this.updateOld = false\r\n    this.props.changeSelection({\r\n      coords: { top, left, width, height },\r\n      imageData: this.props.selectionImageData\r\n    })\r\n  }\r\n\r\n  handleMoveEnd = ({ top, left, width, height }: SelectionCoords) => {\r\n    if (!this.newCtx) throw new Error(\"Coudn't acquire context\")\r\n    this.updateOld = false\r\n    this.props.changeImage(\r\n      this.newCtx.getImageData(\r\n        0,\r\n        0,\r\n        this.newCtx.canvas.width,\r\n        this.newCtx.canvas.height\r\n      )\r\n    )\r\n  }\r\n\r\n  resizeCanvasToFitPasted = () => {\r\n    const canvas = document.createElement('canvas')\r\n    canvas.width = Math.max(\r\n      this.props.imageData.width,\r\n      this.props.selectionImageData.width\r\n    )\r\n    canvas.height = Math.max(\r\n      this.props.imageData.height,\r\n      this.props.selectionImageData.height\r\n    )\r\n    const ctx = canvas.getContext('2d')\r\n\r\n    if (!ctx) throw new Error(\"Coudn't acquire context\")\r\n    ctx.fillStyle = `rgb(${this.props.secondaryColor.r}, ${this.props.secondaryColor.g}, ${this.props.secondaryColor.b})`\r\n    ctx.fillRect(0, 0, ctx.canvas.width, ctx.canvas.height)\r\n    ctx.putImageData(this.props.imageData, 0, 0)\r\n\r\n    this.props.changeImage(\r\n      ctx.getImageData(0, 0, ctx.canvas.width, ctx.canvas.height)\r\n    )\r\n  }\r\n}\r\n","import React, {\r\n  PureComponent,\r\n  createRef,\r\n  RefObject,\r\n  PointerEvent as ReactPointerEvent\r\n} from 'react'\r\n\r\nimport { connect } from 'react-redux'\r\n\r\nimport { ZoneSelection } from './ZoneSelection/ZoneSelection'\r\nimport { ImageDataSelection } from './ImageDataSelection/ImageDataSelection'\r\n\r\nimport './SelectionInstrument.css'\r\n\r\nimport {\r\n  changeImage,\r\n  changeSelection,\r\n  SelectionCoords,\r\n  Color,\r\n  Action\r\n} from '../../../actions'\r\nimport { StoreState } from '../../../reducers'\r\nimport { ThunkDispatch } from 'redux-thunk'\r\n\r\n// the selection is not working quite right:\r\n// there's no way a person can select the full width\r\n// of the picture, because max coordinate is width-1.\r\n// interesting that full height is selectable though.\r\n// at least it works somehow, will polish it later maybe.\r\n\r\nexport interface SelectionInstrumentProps {\r\n  imageData: ImageData\r\n  selectionCoords?: SelectionCoords\r\n  selectionImageData?: ImageData\r\n  secondaryColor: Color\r\n  changeSelection: (data: {\r\n    coords?: SelectionCoords | null\r\n    imageData?: ImageData | null\r\n  }) => void\r\n  changeImage: (imageData: ImageData) => void\r\n}\r\n\r\nexport interface SelectionInstrumentState {\r\n  selecting: boolean\r\n  selectingX: number | null\r\n  selectingY: number | null\r\n  selectingCoords: SelectionCoords | null\r\n  selectionOriginCoords: SelectionCoords | null\r\n}\r\n\r\nclass _SelectionInstrument extends PureComponent<\r\n  SelectionInstrumentProps,\r\n  SelectionInstrumentState\r\n> {\r\n  containerRef: RefObject<HTMLDivElement> = createRef()\r\n\r\n  backgroundColor: Color | null = null\r\n\r\n  preventContextMenu: boolean = false\r\n\r\n  constructor(props: SelectionInstrumentProps) {\r\n    super(props)\r\n\r\n    this.state = {\r\n      selecting: false,\r\n      selectingX: null,\r\n      selectingY: null,\r\n      selectingCoords: null,\r\n      selectionOriginCoords: null\r\n    }\r\n\r\n    // todo - imageData selection handling\r\n  }\r\n\r\n  render() {\r\n    let El\r\n    if (this.state.selecting && this.state.selectingCoords) {\r\n      El = (\r\n        <div\r\n          className=\"selecting\"\r\n          style={{\r\n            top: `${this.state.selectingCoords.top}px`,\r\n            left: `${this.state.selectingCoords.left}px`,\r\n            width: `${this.state.selectingCoords.width}px`,\r\n            height: `${this.state.selectingCoords.height}px`\r\n          }}\r\n        />\r\n      )\r\n    } else if (this.props.selectionImageData) {\r\n      if (!this.props.selectionCoords)\r\n        throw new Error('No selection coords were passed')\r\n      El = (\r\n        <ImageDataSelection\r\n          onClickOutside={(e: ReactPointerEvent<HTMLCanvasElement>) =>\r\n            this.handlePointerDown(e, true)\r\n          }\r\n          imageData={this.props.imageData}\r\n          coords={this.props.selectionCoords}\r\n          selectionImageData={this.props.selectionImageData}\r\n          changeSelection={this.props.changeSelection}\r\n          changeImage={(imageData: ImageData) =>\r\n            this.props.changeImage(imageData)\r\n          }\r\n          secondaryColor={this.props.secondaryColor}\r\n        />\r\n      )\r\n    } else if (this.props.selectionCoords) {\r\n      El = (\r\n        <ZoneSelection\r\n          onClickOutside={e => this.handlePointerDown(e, true)}\r\n          imageData={this.props.imageData}\r\n          coords={this.props.selectionCoords}\r\n          onCoordsChanged={(zone: SelectionCoords) =>\r\n            this.props.changeSelection({ coords: zone })\r\n          }\r\n          onImageChanged={(imageData: ImageData) =>\r\n            this.props.changeImage(imageData)\r\n          }\r\n          secondaryColor={this.props.secondaryColor}\r\n        />\r\n      )\r\n    } else El = null\r\n    return (\r\n      <div\r\n        className=\"selection\"\r\n        onPointerDown={this.handlePointerDown}\r\n        ref={this.containerRef}>\r\n        {El}\r\n      </div>\r\n    )\r\n  }\r\n\r\n  handlePointerDown = (\r\n    e:\r\n      | ReactPointerEvent<HTMLDivElement>\r\n      | ReactPointerEvent<HTMLCanvasElement>\r\n      | MouseEvent,\r\n    trusted?: boolean\r\n  ) => {\r\n    if (e.target !== e.currentTarget) return\r\n\r\n    this.props.changeSelection({})\r\n\r\n    if (!this.containerRef.current) throw new Error(\"Couldn't get ref to div\")\r\n\r\n    let {\r\n      top,\r\n      left,\r\n      bottom,\r\n      right\r\n    } = this.containerRef.current.getBoundingClientRect()\r\n    ;[top, left, bottom, right] = [\r\n      top + window.pageYOffset,\r\n      left + window.pageXOffset,\r\n      bottom + window.pageYOffset,\r\n      right + window.pageXOffset\r\n    ]\r\n    const [mouseX, mouseY] = [\r\n      e.clientX + window.pageXOffset,\r\n      e.clientY + window.pageYOffset\r\n    ]\r\n    ;[top, left] = [Math.ceil(mouseY - top), Math.ceil(mouseX - left)]\r\n    this.setState({\r\n      selecting: true,\r\n      selectingY: top,\r\n      selectingX: left,\r\n      selectingCoords: null\r\n    })\r\n  }\r\n\r\n  handleDocumentPointerMove = (e: PointerEvent) => {\r\n    if (!this.state.selecting) return\r\n\r\n    switch (e.buttons) {\r\n      case 1:\r\n        this.setState(state => {\r\n          // getting bounding rect and mouse coords relatively to document, not viewport\r\n          if (!this.containerRef.current)\r\n            throw new Error(\"Couldn't get ref to div\")\r\n          let {\r\n            top,\r\n            left,\r\n            bottom,\r\n            right\r\n          } = this.containerRef.current.getBoundingClientRect()\r\n          ;[top, left, bottom, right] = [\r\n            top + window.pageYOffset,\r\n            left + window.pageXOffset,\r\n            bottom + window.pageYOffset,\r\n            right + window.pageXOffset\r\n          ]\r\n          const [mouseX, mouseY] = [\r\n            e.clientX + window.pageXOffset,\r\n            e.clientY + window.pageYOffset\r\n          ]\r\n\r\n          // getting top and left coordinates of current mouse position relatively to canvas\r\n          let [canvasRelativeTop, canvasRelativeLeft] = [\r\n              Math.trunc(mouseY - top),\r\n              Math.trunc(mouseX - left)\r\n            ]\r\n            // clamping top and left coordinates between 0 and canvas width\r\n            //\r\n          ;[canvasRelativeTop, canvasRelativeLeft] = [\r\n            Math.max(\r\n              0,\r\n              Math.min(canvasRelativeTop, this.props.imageData.height)\r\n            ),\r\n            Math.max(\r\n              0,\r\n              Math.min(canvasRelativeLeft, this.props.imageData.width)\r\n            )\r\n          ]\r\n\r\n          // console.log(canvasRelativeTop, canvasRelativeLeft)\r\n\r\n          if (\r\n            typeof state.selectingX !== 'number' ||\r\n            typeof state.selectingY !== 'number'\r\n          )\r\n            throw new Error('No coordinates in the state')\r\n          const selectingCoords = {\r\n            top: Math.min(state.selectingY, canvasRelativeTop),\r\n            left: Math.min(state.selectingX, canvasRelativeLeft),\r\n            width: Math.max(\r\n              Math.max(state.selectingX, canvasRelativeLeft) -\r\n                Math.min(state.selectingX, canvasRelativeLeft),\r\n              0\r\n            ),\r\n            height: Math.max(\r\n              Math.max(state.selectingY, canvasRelativeTop) -\r\n                Math.min(state.selectingY, canvasRelativeTop),\r\n              0\r\n            )\r\n          }\r\n\r\n          return {\r\n            selectingCoords\r\n          }\r\n        })\r\n        break\r\n      case 2:\r\n      case 3:\r\n        this.setState({\r\n          selecting: false,\r\n          selectingX: null,\r\n          selectingY: null,\r\n          selectingCoords: null\r\n        })\r\n        this.preventContextMenu = true\r\n        break // no default\r\n    }\r\n  }\r\n\r\n  handleDocumentPointerUp = (e: PointerEvent) => {\r\n    this.setState(state => {\r\n      let selectionOriginCoords: SelectionCoords | null = null\r\n      // also checking if user just clicked without moving (so there's no selectionCoords)\r\n      // if (state.selecting && state.selectingCoords) {\r\n      //   if (\r\n      //     state.selectingCoords.width > 0 &&\r\n      //     state.selectingCoords.height > 0\r\n      //   ) {\r\n      //     this.props.changeSelection({\r\n      //       coords: state.selectingCoords,\r\n      //       imageData: null\r\n      //     })\r\n      //     selectionOriginCoords = state.selectingCoords\r\n      //   }\r\n      //   return {\r\n      //     selecting: false,\r\n      //     selectingX: null,\r\n      //     selectingY: null,\r\n      //     selectingCoords: null,\r\n      //     selectionOriginCoords\r\n      //   }\r\n      // } else {\r\n      //   return {\r\n      //     selecting: false,\r\n      //     selectingX: null,\r\n      //     selectingY: null\r\n      //   }\r\n      // }\r\n      if (state.selecting && state.selectingCoords) {\r\n        if (\r\n          state.selectingCoords.width > 0 &&\r\n          state.selectingCoords.height > 0\r\n        ) {\r\n          this.props.changeSelection({\r\n            coords: state.selectingCoords,\r\n            imageData: null\r\n          })\r\n          selectionOriginCoords = state.selectingCoords\r\n        }\r\n        return {\r\n          selecting: false,\r\n          selectingX: null,\r\n          selectingY: null,\r\n          selectingCoords: null,\r\n          selectionOriginCoords\r\n        }\r\n      } else\r\n        return {\r\n          selecting: false,\r\n          selectingX: null,\r\n          selectingY: null,\r\n          selectingCoords: state.selectingCoords,\r\n          selectionOriginCoords: state.selectionOriginCoords\r\n        }\r\n    })\r\n  }\r\n\r\n  componentDidMount() {\r\n    document.addEventListener('pointermove', this.handleDocumentPointerMove, {\r\n      passive: true\r\n    })\r\n    document.addEventListener('pointerup', this.handleDocumentPointerUp, {\r\n      passive: true\r\n    })\r\n    document.addEventListener('contextmenu', this.handleContextMenu)\r\n  }\r\n\r\n  componentWillUnmount() {\r\n    document.removeEventListener('pointermove', this.handleDocumentPointerMove)\r\n    document.removeEventListener('pointerup', this.handleDocumentPointerUp)\r\n    document.removeEventListener('contextmenu', this.handleContextMenu)\r\n  }\r\n\r\n  handleContextMenu = (e: Event) => {\r\n    if (this.preventContextMenu) {\r\n      e.preventDefault()\r\n      this.preventContextMenu = false\r\n    }\r\n  }\r\n}\r\n\r\nconst mapStateToProps = (state: StoreState) => ({\r\n  imageData: state.image.data,\r\n  selectionCoords: state.instruments.selection\r\n    ? state.instruments.selection.coords\r\n    : undefined,\r\n  selectionImageData: state.instruments.selection\r\n    ? state.instruments.selection.imageData\r\n    : undefined,\r\n  secondaryColor: state.colors.list[state.colors.secondary]\r\n})\r\nconst mapDispatchToProps = (\r\n  dispatch: ThunkDispatch<StoreState, undefined, Action>\r\n) => ({\r\n  changeSelection: ({\r\n    coords,\r\n    imageData\r\n  }: {\r\n    coords?: SelectionCoords | null\r\n    imageData?: ImageData | null\r\n  }) => dispatch(changeSelection({ coords, imageData })),\r\n  changeImage: (imageData: ImageData) => dispatch(changeImage(imageData))\r\n})\r\n\r\nexport const SelectionInstrument = connect(\r\n  mapStateToProps,\r\n  mapDispatchToProps\r\n)(_SelectionInstrument)\r\n","import { ActionTypes } from '.'\r\nimport { ChangeInstrumentAction, Instruments } from './instruments'\r\n\r\nexport interface SelectionCoords {\r\n  left: number\r\n  top: number\r\n  width: number\r\n  height: number\r\n}\r\n\r\nexport const changeSelection = ({\r\n  coords,\r\n  imageData\r\n}: {\r\n  coords?: SelectionCoords | null\r\n  imageData?: ImageData | null\r\n}): ChangeInstrumentAction => {\r\n  return {\r\n    type: ActionTypes.changeInstrument,\r\n    instrument: Instruments.selection,\r\n    selection: {\r\n      coords,\r\n      imageData\r\n    }\r\n  }\r\n}\r\n\r\nexport const disableSelection = (): ChangeInstrumentAction => {\r\n  return {\r\n    type: ActionTypes.changeInstrument,\r\n    selection: null\r\n  }\r\n}\r\n","import React, {\r\n  PureComponent,\r\n  createRef,\r\n  RefObject,\r\n  PointerEvent as ReactPointerEvent\r\n} from 'react'\r\n\r\nimport { connect } from 'react-redux'\r\n\r\nimport './Pen.css'\r\nimport { bresenhamLine, getCanvasCoordsFromEvent } from '../../helpers'\r\nimport { changeImage, Color, Action } from '../../../actions'\r\n\r\nimport { ThunkDispatch } from 'redux-thunk'\r\nimport { StoreState } from '../../../reducers'\r\n\r\nexport interface PenProps {\r\n  color: Color\r\n  imageData: ImageData\r\n  changeImage: (imageData: ImageData) => void\r\n}\r\n\r\nclass _Pen extends PureComponent<PenProps> {\r\n  canvasRef: RefObject<HTMLCanvasElement> = createRef<HTMLCanvasElement>()\r\n\r\n  ctx?: CanvasRenderingContext2D\r\n\r\n  isDrawing: boolean = false\r\n\r\n  prevX: number = 0\r\n\r\n  prevY: number = 0\r\n\r\n  preventContextMenu: boolean = false\r\n\r\n  render() {\r\n    return (\r\n      <canvas\r\n        className=\"pen-canvas\"\r\n        ref={this.canvasRef}\r\n        width={this.props.imageData ? this.props.imageData.width : 0}\r\n        height={this.props.imageData ? this.props.imageData.height : 0}\r\n        onPointerDown={this.handlePointerDown}\r\n        onPointerMove={this.handlePointerMove}\r\n        onPointerEnter={this.handlePointerEnter}\r\n        onPointerLeave={this.handlePointerLeave}\r\n      />\r\n    )\r\n  }\r\n\r\n  handlePointerDown = (e: ReactPointerEvent) => {\r\n    if (!this.canvasRef.current) throw new Error(\"Canvas didn't mount\")\r\n    this.isDrawing = true\r\n    const [x, y] = getCanvasCoordsFromEvent(this.canvasRef.current, e)\r\n    this.beginDrawing(x, y)\r\n  }\r\n\r\n  handlePointerMove = (e: ReactPointerEvent) => {\r\n    if (!this.canvasRef.current) throw new Error(\"Canvas didn't mount\")\r\n    if (this.isDrawing && e.buttons !== 3) {\r\n      const [x, y] = getCanvasCoordsFromEvent(this.canvasRef.current, e)\r\n      this.continueDrawing(x, y)\r\n    }\r\n  }\r\n\r\n  handlePointerEnter = (e: ReactPointerEvent) => {\r\n    if (!this.canvasRef.current) throw new Error(\"Canvas didn't mount\")\r\n    if (e.buttons === 1 && this.isDrawing) {\r\n      const [x, y] = getCanvasCoordsFromEvent(this.canvasRef.current, e)\r\n      this.continueDrawing(x, y)\r\n    } else {\r\n      this.isDrawing = false\r\n    }\r\n  }\r\n\r\n  handlePointerLeave = (e: ReactPointerEvent) => {\r\n    if (!this.canvasRef.current) throw new Error(\"Canvas didn't mount\")\r\n    if (this.isDrawing) {\r\n      const [x, y] = getCanvasCoordsFromEvent(this.canvasRef.current, e)\r\n      this.continueDrawing(x, y)\r\n    }\r\n  }\r\n\r\n  handleDocumentPointerUp = () => {\r\n    if (this.isDrawing) {\r\n      this.isDrawing = false\r\n      this.endDrawing()\r\n    }\r\n  }\r\n\r\n  handleDocumentPointerMove = (e: PointerEvent) => {\r\n    if (!this.canvasRef.current) throw new Error(\"Canvas didn't mount\")\r\n    if (e.target !== this.canvasRef.current) {\r\n      ;[this.prevX, this.prevY] = getCanvasCoordsFromEvent(\r\n        this.canvasRef.current,\r\n        e\r\n      )\r\n    }\r\n    if (this.isDrawing && e.button === 2) {\r\n      this.preventContextMenu = true\r\n      this.cancelDrawing()\r\n    }\r\n  }\r\n\r\n  handleDocumentContextMenu = (e: Event) => {\r\n    if (this.isDrawing) {\r\n      e.preventDefault()\r\n      this.isDrawing = false\r\n    }\r\n  }\r\n\r\n  handleDocumentSelectStart = (e: Event) => {\r\n    if (this.isDrawing) {\r\n      e.preventDefault()\r\n    }\r\n  }\r\n\r\n  componentDidMount() {\r\n    if (!this.canvasRef.current) throw new Error(\"Canvas didn't mount\")\r\n    this.ctx = this.canvasRef.current.getContext('2d') || undefined\r\n    if (!this.ctx) throw new Error(\"Coudn't acquire context\")\r\n    if (this.props.imageData != null) {\r\n      this.ctx.putImageData(this.props.imageData, 0, 0)\r\n    }\r\n    document.addEventListener('pointerup', this.handleDocumentPointerUp)\r\n    document.addEventListener('pointermove', this.handleDocumentPointerMove)\r\n    document.addEventListener('selectstart', this.handleDocumentSelectStart)\r\n    document.addEventListener('contextmenu', this.handleDocumentContextMenu)\r\n  }\r\n\r\n  componentWillUnmount() {\r\n    document.removeEventListener('pointerup', this.handleDocumentPointerUp)\r\n    document.removeEventListener('pointermove', this.handleDocumentPointerMove)\r\n    document.removeEventListener('selectstart', this.handleDocumentSelectStart)\r\n    document.removeEventListener('contextmenu', this.handleDocumentContextMenu)\r\n  }\r\n\r\n  componentDidUpdate() {\r\n    if (!this.ctx) throw new Error(\"Coudn't acquire context\")\r\n    if (this.props.imageData != null) {\r\n      this.ctx.putImageData(this.props.imageData, 0, 0)\r\n    }\r\n  }\r\n\r\n  beginDrawing = (x: number, y: number) => {\r\n    if (!this.ctx) throw new Error(\"Coudn't acquire context\")\r\n    const { r, g, b } = this.props.color\r\n    this.ctx.fillStyle = `rgb(${r},${g},${b})`\r\n    this.ctx.fillRect(x, y, 1, 1)\r\n    ;[this.prevX, this.prevY] = [x, y]\r\n  }\r\n\r\n  continueDrawing = (x: number, y: number) => {\r\n    bresenhamLine(this.prevX, this.prevY, x, y, this.drawPoint)\r\n    ;[this.prevX, this.prevY] = [x, y]\r\n  }\r\n\r\n  endDrawing = () => {\r\n    if (!this.canvasRef.current) throw new Error(\"Canvas didn't mount\")\r\n    if (!this.ctx) throw new Error(\"Coudn't acquire context\")\r\n    this.props.changeImage(\r\n      this.ctx.getImageData(\r\n        0,\r\n        0,\r\n        this.canvasRef.current.width,\r\n        this.canvasRef.current.height\r\n      )\r\n    )\r\n  }\r\n\r\n  cancelDrawing = () => {\r\n    if (!this.ctx) throw new Error(\"Coudn't acquire context\")\r\n    this.ctx.putImageData(this.props.imageData, 0, 0)\r\n  }\r\n\r\n  drawPoint = (x: number, y: number) => {\r\n    if (!this.ctx) throw new Error(\"Coudn't acquire context\")\r\n    this.ctx.fillRect(x, y, 1, 1)\r\n  }\r\n}\r\n\r\nconst mapStateToProps = (state: StoreState) => ({\r\n  color: state.colors.list[state.colors.primary],\r\n  imageData: state.image.data\r\n})\r\nconst mapDispatchToProps = (\r\n  dispatch: ThunkDispatch<StoreState, undefined, Action>\r\n) => ({\r\n  changeImage: (imageData: ImageData) => dispatch(changeImage(imageData))\r\n})\r\n\r\nexport const Pen = connect(\r\n  mapStateToProps,\r\n  mapDispatchToProps\r\n)(_Pen)\r\n","import React, { PureComponent, createRef, RefObject, MouseEvent } from 'react'\r\n\r\nimport { connect } from 'react-redux'\r\n\r\nimport './Fill.css'\r\nimport { getCanvasCoordsFromEvent } from '../../helpers'\r\nimport { Color, Action, changeImage } from '../../../actions'\r\nimport { ThunkDispatch } from 'redux-thunk'\r\nimport { StoreState } from '../../../reducers'\r\n\r\nexport interface FillProps {\r\n  color: Color\r\n  imageData: ImageData\r\n  changeImage: (imageData: ImageData) => void\r\n}\r\n\r\ntype Point = [number, number]\r\n\r\nclass _Fill extends PureComponent<FillProps> {\r\n  canvasRef: RefObject<HTMLCanvasElement>\r\n\r\n  ctx?: CanvasRenderingContext2D\r\n\r\n  constructor(props: FillProps) {\r\n    super(props)\r\n    this.canvasRef = createRef<HTMLCanvasElement>()\r\n  }\r\n\r\n  render() {\r\n    return (\r\n      <canvas\r\n        className=\"fill-canvas\"\r\n        ref={this.canvasRef}\r\n        width={this.props.imageData ? this.props.imageData.width : 0}\r\n        height={this.props.imageData ? this.props.imageData.height : 0}\r\n        onMouseDown={this.handleMouseDown}\r\n      />\r\n    )\r\n  }\r\n\r\n  handleMouseDown = (e: MouseEvent) => {\r\n    if (!this.canvasRef.current) throw new Error(\"Canvas didn't mount\")\r\n    const [x, y] = getCanvasCoordsFromEvent(this.canvasRef.current, e)\r\n    if (!this.ctx) throw new Error(\"Coudn't acquire context\")\r\n    const data = this.ctx.getImageData(\r\n      0,\r\n      0,\r\n      this.canvasRef.current.width,\r\n      this.canvasRef.current.height\r\n    )\r\n    this.floodFill(\r\n      data,\r\n      x,\r\n      y,\r\n      {\r\n        r: data.data[(y * data.width + x) * 4],\r\n        g: data.data[(y * data.width + x) * 4 + 1],\r\n        b: data.data[(y * data.width + x) * 4 + 2]\r\n      },\r\n      this.props.color\r\n    )\r\n    this.props.changeImage(data)\r\n  }\r\n\r\n  // optimized the shit out of it (as I can judge)\r\n  floodFill = (\r\n    data: ImageData,\r\n    x: number,\r\n    y: number,\r\n    colorToReplace: Color,\r\n    colorToFillWith: Color\r\n  ) => {\r\n    const replaceR = colorToReplace.r\r\n    const replaceG = colorToReplace.g\r\n    const replaceB = colorToReplace.b\r\n    const fillR = colorToFillWith.r\r\n    const fillG = colorToFillWith.g\r\n    const fillB = colorToFillWith.b\r\n\r\n    const i = (y * data.width + x) * 4\r\n\r\n    if (\r\n      !(\r\n        replaceR === data.data[i] &&\r\n        replaceG === data.data[i + 1] &&\r\n        replaceB === data.data[i + 2]\r\n      ) ||\r\n      (replaceR === fillR && replaceG === fillG && replaceB === fillB)\r\n    ) {\r\n      return\r\n    }\r\n\r\n    const q: Point[] = []\r\n\r\n    data.data[i] = fillR\r\n    data.data[i + 1] = fillG\r\n    data.data[i + 2] = fillB\r\n\r\n    q.push([x, y])\r\n\r\n    while (q.length !== 0) {\r\n      const n = q.shift()!\r\n      const i = (n[1] * data.width + n[0]) * 4\r\n      if (\r\n        n[0] > 0 &&\r\n        (replaceR === data.data[i - 4] &&\r\n          replaceG === data.data[i - 3] &&\r\n          replaceB === data.data[i - 2])\r\n      ) {\r\n        data.data[i - 4] = fillR\r\n        data.data[i - 3] = fillG\r\n        data.data[i - 2] = fillB\r\n        q.push([n[0] - 1, n[1]])\r\n      }\r\n      if (\r\n        n[0] < data.width - 1 &&\r\n        (replaceR === data.data[i + 4] &&\r\n          replaceG === data.data[i + 5] &&\r\n          replaceB === data.data[i + 6])\r\n      ) {\r\n        data.data[i + 4] = fillR\r\n        data.data[i + 5] = fillG\r\n        data.data[i + 6] = fillB\r\n        q.push([n[0] + 1, n[1]])\r\n      }\r\n      if (\r\n        n[1] > 0 &&\r\n        (replaceR === data.data[i - data.width * 4] &&\r\n          replaceG === data.data[i - data.width * 4 + 1] &&\r\n          replaceB === data.data[i - data.width * 4 + 2])\r\n      ) {\r\n        data.data[i - data.width * 4] = fillR\r\n        data.data[i - data.width * 4 + 1] = fillG\r\n        data.data[i - data.width * 4 + 2] = fillB\r\n        q.push([n[0], n[1] - 1])\r\n      }\r\n      if (\r\n        n[1] < data.height - 1 &&\r\n        (replaceR === data.data[i + data.width * 4] &&\r\n          replaceG === data.data[i + data.width * 4 + 1] &&\r\n          replaceB === data.data[i + data.width * 4 + 2])\r\n      ) {\r\n        data.data[i + data.width * 4] = fillR\r\n        data.data[i + data.width * 4 + 1] = fillG\r\n        data.data[i + data.width * 4 + 2] = fillB\r\n        q.push([n[0], n[1] + 1])\r\n      }\r\n    }\r\n  }\r\n\r\n  componentDidMount() {\r\n    if (!this.canvasRef.current) throw new Error(\"Canvas didn't mount\")\r\n    this.ctx = this.canvasRef.current.getContext('2d') || undefined\r\n    if (!this.ctx) throw new Error(\"Coudn't acquire context\")\r\n    if (this.props.imageData != null) {\r\n      this.ctx.putImageData(this.props.imageData, 0, 0)\r\n    }\r\n  }\r\n\r\n  componentDidUpdate() {\r\n    if (!this.ctx) throw new Error(\"Coudn't acquire context\")\r\n    this.ctx.putImageData(this.props.imageData, 0, 0)\r\n  }\r\n}\r\n\r\nconst mapStateToProps = (state: StoreState) => ({\r\n  color: state.colors.list[state.colors.primary],\r\n  imageData: state.image.data\r\n})\r\n\r\nconst mapDispatchToProps = (\r\n  dispatch: ThunkDispatch<StoreState, undefined, Action>\r\n) => ({\r\n  changeImage: (imageData: ImageData) => dispatch(changeImage(imageData))\r\n})\r\n\r\nexport const Fill = connect(\r\n  mapStateToProps,\r\n  mapDispatchToProps\r\n)(_Fill)\r\n","import React, { PureComponent, MouseEventHandler } from 'react'\r\n\r\nimport { connect } from 'react-redux'\r\nimport {\r\n  addColor,\r\n  selectInstrument,\r\n  Action,\r\n  Color,\r\n  Instruments\r\n} from '../../../actions'\r\nimport './Dropper.css'\r\nimport { ThunkDispatch } from 'redux-thunk'\r\nimport { StoreState } from '../../../reducers'\r\n\r\ninterface DropperProps {\r\n  imageData: ImageData\r\n  addColor: (color: Color) => void\r\n  selectInstrument: (instrument: Instruments) => void\r\n}\r\n\r\nclass _Dropper extends PureComponent<DropperProps> {\r\n  render() {\r\n    return (\r\n      <div\r\n        className=\"dropper\"\r\n        onClick={this.handleClick}\r\n        style={{\r\n          width: this.props.imageData.width,\r\n          height: this.props.imageData.height\r\n        }}\r\n      />\r\n    )\r\n  }\r\n\r\n  handleClick: MouseEventHandler = e => {\r\n    if (!e.target || e.target !== e.currentTarget) return\r\n\r\n    let {\r\n      top,\r\n      left,\r\n      bottom,\r\n      right\r\n    } = (e.target as HTMLElement).getBoundingClientRect()\r\n    ;[top, left, bottom, right] = [\r\n      top + window.pageYOffset,\r\n      left + window.pageXOffset,\r\n      bottom + window.pageYOffset,\r\n      right + window.pageXOffset\r\n    ]\r\n    const [mouseX, mouseY] = [\r\n      e.clientX + window.pageXOffset,\r\n      e.clientY + window.pageYOffset\r\n    ]\r\n    ;[top, left] = [Math.ceil(mouseY - top), Math.ceil(mouseX - left)]\r\n\r\n    const i = (top * this.props.imageData.width + left) * 4\r\n\r\n    this.props.addColor({\r\n      r: this.props.imageData.data[i],\r\n      g: this.props.imageData.data[i + 1],\r\n      b: this.props.imageData.data[i + 2]\r\n    })\r\n    this.props.selectInstrument(Instruments.pen)\r\n  }\r\n}\r\n\r\nconst mapStateToProps = (state: StoreState) => ({\r\n  imageData: state.image.data\r\n})\r\nconst mapDispatchToProps = (\r\n  dispatch: ThunkDispatch<StoreState, undefined, Action>\r\n) => ({\r\n  addColor: (color: Color) => dispatch(addColor(color)),\r\n  selectInstrument: (instrument: Instruments) =>\r\n    dispatch(selectInstrument(instrument))\r\n})\r\n\r\nexport const Dropper = connect(\r\n  mapStateToProps,\r\n  mapDispatchToProps\r\n)(_Dropper)\r\n","import React, {\r\n  PureComponent,\r\n  createRef,\r\n  RefObject,\r\n  PointerEvent as ReactPointerEvent\r\n} from 'react'\r\n\r\nimport { connect } from 'react-redux'\r\n\r\nimport './Eraser.css'\r\nimport { bresenhamLine, getCanvasCoordsFromEvent } from '../../helpers'\r\nimport { Color, Action, changeImage } from '../../../actions'\r\nimport { StoreState } from '../../../reducers'\r\nimport { ThunkDispatch } from 'redux-thunk'\r\n\r\nexport interface EraserProps {\r\n  color: Color\r\n  imageData: ImageData\r\n  changeImage: (imageData: ImageData) => void\r\n  thickness: number // insert true one after thickness is made\r\n}\r\n\r\nclass _Eraser extends PureComponent<EraserProps> {\r\n  canvasRef: RefObject<HTMLCanvasElement> = createRef<HTMLCanvasElement>()\r\n\r\n  ctx?: CanvasRenderingContext2D\r\n\r\n  noCursorCtx: CanvasRenderingContext2D\r\n\r\n  isDrawing: boolean = false\r\n\r\n  prevX: number = 0\r\n\r\n  prevY: number = 0\r\n\r\n  preventContextMenu: boolean = false\r\n\r\n  constructor(props: EraserProps) {\r\n    super(props)\r\n    const noCursorCanvas = document.createElement('canvas')\r\n    const noCursorCtx = noCursorCanvas.getContext('2d')\r\n    if (!noCursorCtx) throw new Error(\"Coudn't acquire context\")\r\n    this.noCursorCtx = noCursorCtx\r\n  }\r\n\r\n  render() {\r\n    return (\r\n      <canvas\r\n        className=\"eraser-canvas\"\r\n        ref={this.canvasRef}\r\n        width={this.props.imageData ? this.props.imageData.width : 0}\r\n        height={this.props.imageData ? this.props.imageData.height : 0}\r\n        onPointerDown={this.handlePointerDown}\r\n        onPointerMove={this.handlePointerMove}\r\n        onPointerEnter={this.handlePointerEnter}\r\n        onPointerLeave={this.handlePointerLeave}\r\n      />\r\n    )\r\n  }\r\n\r\n  handlePointerDown = (e: ReactPointerEvent<HTMLCanvasElement>) => {\r\n    if (!this.canvasRef.current) throw new Error(\"Canvas didn't mount\")\r\n    this.isDrawing = true\r\n    const [x, y] = getCanvasCoordsFromEvent(this.canvasRef.current, e)\r\n    this.drawPoint(x, y)\r\n    this.beginDrawing(x, y)\r\n  }\r\n\r\n  handlePointerMove = (e: ReactPointerEvent<HTMLCanvasElement>) => {\r\n    if (!this.canvasRef.current) throw new Error(\"Canvas didn't mount\")\r\n    const [x, y] = getCanvasCoordsFromEvent(this.canvasRef.current, e)\r\n    if (this.isDrawing && e.buttons !== 3) {\r\n      this.continueDrawing(x, y)\r\n    }\r\n    this.updateCanvas(x, y)\r\n  }\r\n\r\n  handlePointerEnter = (e: ReactPointerEvent<HTMLCanvasElement>) => {\r\n    if (!this.canvasRef.current) throw new Error(\"Canvas didn't mount\")\r\n    if (e.buttons === 1 && this.isDrawing) {\r\n      const [x, y] = getCanvasCoordsFromEvent(this.canvasRef.current, e)\r\n      this.continueDrawing(x, y)\r\n    } else {\r\n      this.isDrawing = false\r\n    }\r\n  }\r\n\r\n  handlePointerLeave = (e: ReactPointerEvent<HTMLCanvasElement>) => {\r\n    if (!this.canvasRef.current) throw new Error(\"Canvas didn't mount\")\r\n    if (this.isDrawing) {\r\n      const [x, y] = getCanvasCoordsFromEvent(this.canvasRef.current, e)\r\n      this.continueDrawing(x, y)\r\n    }\r\n    this.updateCanvas()\r\n  }\r\n\r\n  handleDocumentPointerUp = () => {\r\n    if (this.isDrawing) {\r\n      this.isDrawing = false\r\n      this.endDrawing()\r\n    }\r\n  }\r\n\r\n  handleDocumentPointerMove = (e: PointerEvent) => {\r\n    if (!this.canvasRef.current) return\r\n    if (e.target !== this.canvasRef.current) {\r\n      ;[this.prevX, this.prevY] = getCanvasCoordsFromEvent(\r\n        this.canvasRef.current,\r\n        e\r\n      )\r\n    }\r\n    if (this.isDrawing && e.button === 2) {\r\n      this.preventContextMenu = true\r\n      this.cancelDrawing()\r\n    }\r\n  }\r\n\r\n  handleDocumentContextMenu = (e: Event) => {\r\n    if (this.isDrawing) {\r\n      e.preventDefault()\r\n      this.isDrawing = false\r\n    }\r\n  }\r\n\r\n  handleDocumentSelectStart = (e: Event) => {\r\n    if (this.isDrawing) {\r\n      e.preventDefault()\r\n    }\r\n  }\r\n\r\n  componentDidMount() {\r\n    if (!this.canvasRef.current) throw new Error(\"Canvas didn't mount\")\r\n    this.ctx = this.canvasRef.current.getContext('2d') || undefined\r\n    if (!this.ctx) throw new Error(\"Coudn't acquire context\")\r\n    const { r, g, b } = this.props.color\r\n    this.ctx.fillStyle = `rgb(${r},${g},${b})`\r\n    this.ctx.strokeStyle = 'black'\r\n    this.noCursorCtx.fillStyle = `rgb(${r},${g},${b})`\r\n    this.updateCanvasNoCursor()\r\n    document.addEventListener('pointerup', this.handleDocumentPointerUp)\r\n    document.addEventListener('pointermove', this.handleDocumentPointerMove)\r\n    document.addEventListener('selectstart', this.handleDocumentSelectStart)\r\n    document.addEventListener('contextmenu', this.handleDocumentContextMenu)\r\n  }\r\n\r\n  componentDidUpdate() {\r\n    const { r, g, b } = this.props.color\r\n    if (!this.ctx) throw new Error(\"Coudn't acquire context\")\r\n    this.ctx.fillStyle = `rgb(${r},${g},${b})`\r\n    this.noCursorCtx.fillStyle = `rgb(${r},${g},${b})`\r\n    this.updateCanvasNoCursor()\r\n  }\r\n\r\n  componentWillUnmount() {\r\n    document.removeEventListener('pointerup', this.handleDocumentPointerUp)\r\n    document.removeEventListener('pointermove', this.handleDocumentPointerMove)\r\n    document.removeEventListener('selectstart', this.handleDocumentSelectStart)\r\n    document.removeEventListener('contextmenu', this.handleDocumentContextMenu)\r\n  }\r\n\r\n  beginDrawing = (x: number, y: number) => {\r\n    const { r, g, b } = this.props.color\r\n    if (!this.ctx) throw new Error(\"Coudn't acquire context\")\r\n    this.ctx.fillStyle = `rgb(${r},${g},${b})`\r\n    this.drawPoint(x, y)\r\n    ;[this.prevX, this.prevY] = [x, y]\r\n  }\r\n\r\n  continueDrawing = (x: number, y: number) => {\r\n    bresenhamLine(this.prevX, this.prevY, x, y, this.drawPoint)\r\n    ;[this.prevX, this.prevY] = [x, y]\r\n  }\r\n\r\n  endDrawing = () => {\r\n    this.props.changeImage(\r\n      this.noCursorCtx.getImageData(\r\n        0,\r\n        0,\r\n        this.noCursorCtx.canvas.width,\r\n        this.noCursorCtx.canvas.height\r\n      )\r\n    )\r\n  }\r\n\r\n  cancelDrawing = () => {\r\n    this.noCursorCtx.putImageData(this.props.imageData, 0, 0)\r\n  }\r\n\r\n  drawPoint = (x: number, y: number) => {\r\n    if (this.noCursorCtx)\r\n      this.noCursorCtx.fillRect(\r\n        x - this.props.thickness / 2,\r\n        y - this.props.thickness / 2,\r\n        this.props.thickness,\r\n        this.props.thickness\r\n      )\r\n  }\r\n\r\n  updateCanvasNoCursor = () => {\r\n    if (this.props.imageData != null) {\r\n      ;[this.noCursorCtx.canvas.width, this.noCursorCtx.canvas.height] = [\r\n        this.props.imageData.width,\r\n        this.props.imageData.height\r\n      ]\r\n      const { r, g, b } = this.props.color\r\n      this.noCursorCtx.fillStyle = `rgb(${r},${g},${b})`\r\n      this.noCursorCtx.putImageData(this.props.imageData, 0, 0)\r\n    }\r\n  }\r\n\r\n  updateCanvas = (x?: number, y?: number) => {\r\n    if (!this.ctx) throw new Error(\"Coudn't acquire context\")\r\n    this.ctx.drawImage(this.noCursorCtx.canvas, 0, 0)\r\n    if (x !== undefined && y !== undefined) {\r\n      this.ctx.fillRect(\r\n        x - this.props.thickness / 2,\r\n        y - this.props.thickness / 2,\r\n        this.props.thickness,\r\n        this.props.thickness\r\n      )\r\n      this.ctx.strokeRect(\r\n        x - this.props.thickness / 2 + 0.5,\r\n        y - this.props.thickness / 2 + 0.5,\r\n        this.props.thickness - 1,\r\n        this.props.thickness - 1\r\n      )\r\n    }\r\n  }\r\n}\r\n\r\nconst mapStateToProps = (state: StoreState) => ({\r\n  color: state.colors.list[state.colors.secondary],\r\n  imageData: state.image.data,\r\n  thickness: 8 // insert true one after thickness is made\r\n})\r\n\r\nconst mapDispatchToProps = (\r\n  dispatch: ThunkDispatch<StoreState, undefined, Action>\r\n) => ({\r\n  changeImage: (imageData: ImageData) => dispatch(changeImage(imageData))\r\n})\r\n\r\nexport const Eraser = connect(\r\n  mapStateToProps,\r\n  mapDispatchToProps\r\n)(_Eraser)\r\n","import React, { FunctionComponent } from 'react'\r\nimport { connect } from 'react-redux'\r\n\r\nimport { SelectionInstrument } from '../instruments/SelectionInstrument/SelectionInstrument'\r\nimport { Pen } from '../instruments/Pen/Pen'\r\nimport { Fill } from '../instruments/Fill/Fill'\r\nimport { Dropper } from '../instruments/Dropper/Dropper'\r\nimport { Eraser } from '../instruments/Eraser/Eraser'\r\n\r\nimport { StoreState } from '../../reducers'\r\n\r\n// todo maybe can be done better?\r\nconst instruments = {\r\n  pen: Pen,\r\n  fill: Fill,\r\n  selection: SelectionInstrument,\r\n  dropper: Dropper,\r\n  eraser: Eraser\r\n}\r\n\r\ninterface CanvasEditorProps {\r\n  instrument: keyof typeof instruments\r\n}\r\n\r\nconst _CanvasEditor: FunctionComponent<CanvasEditorProps> = (\r\n  props\r\n): JSX.Element | null => {\r\n  const Element = instruments[props.instrument]\r\n  return Element != null ? <Element /> : null\r\n}\r\n\r\nconst mapStateToProps = (state: StoreState) => ({\r\n  instrument: state.instruments.instrument\r\n})\r\n\r\nexport const CanvasEditor = connect(mapStateToProps)(_CanvasEditor)\r\n","import React, { PureComponent, createRef, RefObject } from 'react'\r\n\r\nimport { connect } from 'react-redux'\r\n\r\nimport { changeImage, Color, Action, disableSelection } from '../../actions'\r\n\r\nimport { Resizer, ResizerMode } from '../Resizer/Resizer'\r\nimport { CanvasEditor } from '../CanvasEditor/CanvasEditor'\r\n\r\nimport './Canvas.css'\r\nimport { StoreState } from '../../reducers'\r\nimport { ThunkDispatch } from 'redux-thunk'\r\n\r\nexport interface CanvasProps {\r\n  data: ImageData\r\n  secondaryColor: Color\r\n  changeImage: (imageData: ImageData) => void\r\n  disableSelection: () => void\r\n}\r\n\r\nclass Canvas extends PureComponent<CanvasProps> {\r\n  canvas: RefObject<HTMLCanvasElement> = createRef()\r\n\r\n  render() {\r\n    return (\r\n      <div className=\"canvas-wrapper\">\r\n        <canvas\r\n          ref={this.canvas}\r\n          className=\"canvas\"\r\n          width={this.props.data ? this.props.data.width : 0}\r\n          height={this.props.data ? this.props.data.height : 0}\r\n        />\r\n        <div\r\n          className=\"canvas-upper-layer\"\r\n          style={{\r\n            width: this.props.data ? this.props.data.width : 0,\r\n            height: this.props.data ? this.props.data.height : 0\r\n          }}>\r\n          <Resizer\r\n            mode={ResizerMode.canvas}\r\n            onResizeEnd={this.onResize}\r\n            onResizing={this.props.disableSelection}\r\n            width={this.props.data ? this.props.data.width : 0}\r\n            height={this.props.data ? this.props.data.height : 0}\r\n            top={0}\r\n            left={0}\r\n          />\r\n          <CanvasEditor />\r\n        </div>\r\n      </div>\r\n    )\r\n  }\r\n\r\n  updateCanvas = () => {\r\n    const canvas = this.canvas.current\r\n    if (canvas != null && this.props.data != null) {\r\n      ;[canvas.width, canvas.height] = [\r\n        this.props.data.width,\r\n        this.props.data.height\r\n      ]\r\n      const ctx = canvas.getContext('2d')\r\n      if (!ctx) throw new Error(\"Coudn't acquire context\")\r\n      ctx.putImageData(this.props.data, 0, 0)\r\n    }\r\n  }\r\n\r\n  onResize = (top: number, left: number, toWidth: number, toHeight: number) => {\r\n    if (\r\n      this.props.data.width !== toWidth ||\r\n      this.props.data.height !== toHeight\r\n    ) {\r\n      const newCanvas = document.createElement('canvas')\r\n      newCanvas.width = toWidth\r\n      newCanvas.height = toHeight\r\n      const newCtx = newCanvas.getContext('2d')\r\n      if (!newCtx) throw new Error(\"Coudn't acquire context\")\r\n      newCtx.fillStyle = `rgb(${this.props.secondaryColor.r},${this.props.secondaryColor.g},${this.props.secondaryColor.b})`\r\n      newCtx.fillRect(0, 0, toWidth, toHeight)\r\n      newCtx.putImageData(this.props.data, 0, 0)\r\n      this.props.changeImage(newCtx.getImageData(0, 0, toWidth, toHeight))\r\n    }\r\n  }\r\n\r\n  componentDidMount() {\r\n    this.updateCanvas()\r\n  }\r\n\r\n  componentDidUpdate() {\r\n    this.updateCanvas()\r\n  }\r\n}\r\n\r\nconst mapStateToProps = (state: StoreState) => ({\r\n  data: state.image.data,\r\n  secondaryColor: state.colors.list[state.colors.secondary]\r\n})\r\n\r\nconst mapDispatchToProps = (\r\n  dispatch: ThunkDispatch<StoreState, undefined, Action>\r\n) => ({\r\n  changeImage: (data: ImageData) => dispatch(changeImage(data)),\r\n  disableSelection: () => dispatch(disableSelection())\r\n})\r\n\r\nexport default connect(\r\n  mapStateToProps,\r\n  mapDispatchToProps\r\n)(Canvas)\r\n","import React, { FunctionComponent } from 'react'\r\n\r\nimport './NavBar.css'\r\n\r\nexport const NavBar: FunctionComponent = props => (\r\n  <nav className=\"navbar\">{props.children}</nav>\r\n)\r\n","import React, { FunctionComponent } from 'react'\r\n\r\nimport './NavBarItem.css'\r\n\r\nexport interface NavBarItemProps {\r\n  footer: string\r\n  children: JSX.Element\r\n}\r\n\r\nexport const NavBarItem: FunctionComponent<NavBarItemProps> = props => (\r\n  <section className=\"navbar-item\">\r\n    {props.children}\r\n    <footer>{props.footer}</footer>\r\n  </section>\r\n)\r\n","import React, { FunctionComponent } from 'react'\r\n\r\nimport './Clipboard.css'\r\n\r\nexport const Clipboard: FunctionComponent = (): JSX.Element => (\r\n  <nav className=\"clipboard\">\r\n    <button disabled={false}>Cut</button>\r\n    <button disabled={false}>Copy</button>\r\n    <button disabled={false}>Paste</button>\r\n  </nav>\r\n)\r\n","import React, { Component } from 'react'\r\nimport './Image.css'\r\n\r\nimport { connect } from 'react-redux'\r\n\r\nimport classNames from 'classnames'\r\n\r\nimport {\r\n  selectInstrument,\r\n  Action,\r\n  Instruments,\r\n  changeImage\r\n} from '../../actions'\r\n\r\nimport { ThunkDispatch } from 'redux-thunk'\r\nimport { StoreState } from '../../reducers'\r\n\r\ninterface ImageProps {\r\n  image: ImageData\r\n  instrument: Instruments\r\n  selection: any // todo fix\r\n  selectInstrument: (instrument: Instruments) => void\r\n  changeImage: (imageData: ImageData) => void\r\n}\r\n\r\nclass _Image extends Component<ImageProps> {\r\n  render() {\r\n    return (\r\n      <nav className=\"image\">\r\n        <button\r\n          className={classNames('select', {\r\n            select_active: this.props.instrument === 'selection'\r\n          })}\r\n          onClick={this.handleClick}>\r\n          <svg viewBox=\"0 0 15 10\">\r\n            <rect\r\n              width=\"15\"\r\n              height=\"10\"\r\n              style={{\r\n                fill: 'transparent',\r\n                strokeWidth: '1',\r\n                strokeDasharray: '1',\r\n                stroke: 'black'\r\n              }}\r\n            />\r\n          </svg>\r\n          <footer>Select</footer>\r\n        </button>\r\n        <div className=\"side-buttons\">\r\n          <button\r\n            onClick={this.handleClipClick}\r\n            disabled={!(this.props.selection && this.props.selection.coords)}>\r\n            Cut\r\n          </button>\r\n          <button>Change size</button>\r\n          <button>Rotate</button>\r\n        </div>\r\n      </nav>\r\n    )\r\n  }\r\n\r\n  handleClick = () => {\r\n    this.props.selectInstrument(Instruments.selection)\r\n  }\r\n\r\n  handleClipClick = () => {\r\n    if (!(this.props.selection && this.props.selection.coords)) {\r\n      return\r\n    }\r\n    const newCanvas = document.createElement('canvas')\r\n    const newCtx = newCanvas.getContext('2d')\r\n    ;({\r\n      width: newCanvas.width,\r\n      height: newCanvas.height\r\n    } = this.props.selection.coords)\r\n\r\n    if (!newCtx) throw new Error(\"Couldn't acquire canvas context\")\r\n    newCtx.putImageData(this.props.image, 0, 0)\r\n    this.props.changeImage(\r\n      newCtx.getImageData(\r\n        this.props.selection.coords.left,\r\n        this.props.selection.coords.top,\r\n        this.props.selection.coords.width,\r\n        this.props.selection.coords.height\r\n      )\r\n    )\r\n    this.props.selectInstrument(Instruments.selection)\r\n  }\r\n}\r\n\r\nconst mapStateToProps = (state: StoreState) => ({\r\n  image: state.image.data,\r\n  instrument: state.instruments.instrument,\r\n  selection: state.instruments.selection\r\n})\r\nconst mapDispatchToProps = (\r\n  dispatch: ThunkDispatch<StoreState, undefined, Action>\r\n) => ({\r\n  selectInstrument: (instrument: Instruments) =>\r\n    dispatch(selectInstrument(instrument)),\r\n  changeImage: (imageData: ImageData) => dispatch(changeImage(imageData))\r\n})\r\n\r\nexport const Image = connect(\r\n  mapStateToProps,\r\n  mapDispatchToProps\r\n)(_Image)\r\n","import React, { FunctionComponent } from 'react'\r\n\r\nimport { connect } from 'react-redux'\r\n\r\nimport {\r\n  selectInstrument,\r\n  Instruments as InstrumentsList,\r\n  Action\r\n} from '../../actions'\r\n\r\nimport classNames from 'classnames'\r\nimport './Instruments.css'\r\nimport { StoreState } from '../../reducers'\r\nimport { ThunkDispatch } from 'redux-thunk'\r\n\r\nexport interface InstrumentsProps {\r\n  instrument: InstrumentsList\r\n  selectInstrument: (instrument: InstrumentsList) => void\r\n}\r\n\r\nconst _Instruments: FunctionComponent<InstrumentsProps> = props => (\r\n  <div className=\"instruments\">\r\n    {Object.values(InstrumentsList)\r\n      .filter(\r\n        (instrument: InstrumentsList) =>\r\n          instrument !== InstrumentsList.selection\r\n      )\r\n      .map((i: InstrumentsList) => (\r\n        <button\r\n          className={classNames(`instrument_${i}`, {\r\n            instrument_active: i === props.instrument\r\n          })}\r\n          key={`instrument_${i}`}\r\n          onClick={() => props.selectInstrument(i)}\r\n        />\r\n      ))}\r\n  </div>\r\n)\r\n\r\nconst mapStateToProps = (state: StoreState) => ({\r\n  instrument: state.instruments.instrument\r\n})\r\nconst mapDispatchToProps = (\r\n  dispatch: ThunkDispatch<StoreState, undefined, Action>\r\n) => ({\r\n  selectInstrument: (instrument: InstrumentsList) =>\r\n    dispatch(selectInstrument(instrument))\r\n})\r\n\r\nexport const Instruments = connect(\r\n  mapStateToProps,\r\n  mapDispatchToProps\r\n)(_Instruments)\r\n","import React, { FunctionComponent } from 'react'\r\n\r\nimport './ColorPalette.css'\r\n\r\nexport const ColorPalette: FunctionComponent = (props): JSX.Element => (\r\n  <div className=\"color-palette\">{props.children}</div>\r\n)\r\n","import React, { FunctionComponent, MouseEventHandler } from 'react'\r\nimport classNames from 'classnames'\r\n\r\nimport './ColorSelection.css'\r\n\r\ninterface ColorSelectionProps {\r\n  active: boolean\r\n  color: {\r\n    r: number\r\n    g: number\r\n    b: number\r\n  }\r\n  onClick: MouseEventHandler\r\n  header: string\r\n}\r\n\r\nexport const ColorSelection: FunctionComponent<ColorSelectionProps> = props => (\r\n  <div\r\n    className={classNames('color-selection', {\r\n      'color-selection_active': props.active\r\n    })}\r\n    onClick={props.onClick}>\r\n    <div\r\n      className=\"color-selection-color\"\r\n      style={{\r\n        backgroundColor: `rgb(${props.color.r},${props.color.g},${props.color.b})`\r\n      }}\r\n    />\r\n    <h6 className=\"color-selection-header\">{props.header}</h6>\r\n  </div>\r\n)\r\n","import React, { ChangeEventHandler, FunctionComponent } from 'react'\r\n\r\nimport './ColorInput.css'\r\n\r\nexport interface ColorInputProps {\r\n  onChange: ChangeEventHandler\r\n  value: string\r\n}\r\n\r\nexport const ColorInput: FunctionComponent<ColorInputProps> = (\r\n  props\r\n): JSX.Element => (\r\n  <div className=\"color-input\">\r\n    <label className=\"color-input-wrapper\">\r\n      <input type=\"color\" onChange={props.onChange} value={props.value} />\r\n    </label>\r\n    <h6 className=\"color-input-header\">Change color</h6>\r\n  </div>\r\n)\r\n","import React, { MouseEventHandler, FunctionComponent } from 'react'\r\nimport classNames from 'classnames'\r\n\r\nimport './Color.css'\r\n\r\nexport interface ColorProps {\r\n  onClick?: MouseEventHandler\r\n  value?: {\r\n    r: number\r\n    g: number\r\n    b: number\r\n  }\r\n  active?: boolean\r\n}\r\n\r\nexport const Color: FunctionComponent<ColorProps> = props => {\r\n  return (\r\n    <div\r\n      onClick={props.onClick}\r\n      style={\r\n        props.value && {\r\n          backgroundColor: `rgb(${props.value.r}, ${props.value.g}, ${props.value.b})`\r\n        }\r\n      }\r\n      className={classNames('color', {\r\n        color_active: props.active,\r\n        color_undefined: !props.value\r\n      })}\r\n    />\r\n  )\r\n}\r\n","import React, { ChangeEventHandler, FunctionComponent } from 'react'\r\n\r\nimport './Colors.css'\r\n\r\nimport { ColorPalette } from '../ColorPalette/ColorPalette'\r\nimport { ColorSelection } from '../ColorSelection/ColorSelection'\r\nimport { ColorInput } from '../ColorInput/ColorInput'\r\nimport { Color } from '../Color/Color'\r\n\r\nimport { rgbToHex } from '../helpers'\r\nimport { Color as ColorObject, SelectedColor } from '../../actions'\r\n\r\nexport interface ColorsComponentProps {\r\n  colors: ColorObject[]\r\n  activeColor: SelectedColor\r\n  onColorClick: (colorIndex: number) => void\r\n  onActiveColorClick: (activeColorType: SelectedColor) => void\r\n  onColorInputChange: ChangeEventHandler\r\n  primary: number\r\n  secondary: number\r\n}\r\n\r\nexport const ColorsComponent: FunctionComponent<\r\n  ColorsComponentProps\r\n> = props => (\r\n  <div className=\"colors\">\r\n    <ColorSelection\r\n      header=\"Color 1\"\r\n      color={props.colors[props.primary]}\r\n      active={props.activeColor === SelectedColor.primary}\r\n      onClick={() => props.onActiveColorClick(SelectedColor.primary)}\r\n    />\r\n    <ColorSelection\r\n      header=\"Color 2\"\r\n      color={props.colors[props.secondary]}\r\n      active={props.activeColor === SelectedColor.secondary}\r\n      onClick={() => props.onActiveColorClick(SelectedColor.secondary)}\r\n    />\r\n    <ColorPalette>\r\n      {[\r\n        ...props.colors.map((c, i) => (\r\n          <Color\r\n            value={c}\r\n            active={i === props[props.activeColor]}\r\n            onClick={() => props.onColorClick(i)}\r\n            key={'color' + i}\r\n          />\r\n        )),\r\n        ...new Array(30 - props.colors.length)\r\n          .fill(undefined)\r\n          .map((item, i) => <Color key={'undefinedcolor' + i} />)\r\n      ]}\r\n    </ColorPalette>\r\n    <ColorInput\r\n      onChange={props.onColorInputChange}\r\n      value={rgbToHex(props.colors[props[props.activeColor]])}\r\n    />\r\n  </div>\r\n)\r\n","import React, { PureComponent, ChangeEvent, ChangeEventHandler } from 'react'\r\n\r\nimport { connect } from 'react-redux'\r\n\r\nimport { ColorsComponent } from './ColorsComponent'\r\nimport {\r\n  changeActiveColor,\r\n  selectColor,\r\n  addColorFromInput,\r\n  SelectedColor,\r\n  Color\r\n} from '../../actions/colors'\r\nimport { StoreState } from '../../reducers'\r\nimport { ThunkDispatch } from 'redux-thunk'\r\nimport { Action } from '../../actions'\r\n\r\nexport interface ColorsContainerProps {\r\n  colors: Color[]\r\n  activeColor: SelectedColor\r\n  primary: number\r\n  secondary: number\r\n  onColorClick: (colorIndex: number) => void\r\n  onActiveColorClick: (activeColorType: SelectedColor) => void\r\n  onColorInputChange: ChangeEventHandler<HTMLInputElement>\r\n}\r\n\r\nclass _ColorsContainer extends PureComponent<ColorsContainerProps> {\r\n  render() {\r\n    return <ColorsComponent {...this.props} />\r\n  }\r\n}\r\n\r\nconst mapStateToProps = (state: StoreState) => ({\r\n  colors: state.colors.list,\r\n  activeColor: state.colors.activeColor,\r\n  primary: state.colors.primary,\r\n  secondary: state.colors.secondary\r\n})\r\nconst mapDispatchToProps = (\r\n  dispatch: ThunkDispatch<StoreState, undefined, Action>\r\n) => ({\r\n  onColorClick: (index: number) => dispatch(selectColor(index)),\r\n  onActiveColorClick: (activeColor: SelectedColor) =>\r\n    dispatch(changeActiveColor(activeColor)),\r\n  onColorInputChange: (e: ChangeEvent<HTMLInputElement>) =>\r\n    dispatch(addColorFromInput(e))\r\n})\r\n\r\nexport const ColorsContainer = connect(\r\n  mapStateToProps,\r\n  mapDispatchToProps\r\n)(_ColorsContainer)\r\n","import React, { PureComponent, ChangeEvent } from 'react'\r\n\r\nimport './App.css'\r\n\r\nimport { connect } from 'react-redux'\r\n\r\nimport { FileMenu } from '../FileMenu/FileMenu'\r\nimport Canvas from '../Canvas/Canvas'\r\nimport { NavBar } from '../NavBar/NavBar'\r\nimport { NavBarItem } from '../NavBar/NavBarItem'\r\nimport { Clipboard } from '../Clipboard/Clipboard'\r\nimport { Image } from '../Image/Image'\r\nimport { Instruments } from '../instruments/Instruments'\r\nimport { ColorsContainer } from '../Colors/ColorsContainer'\r\n\r\nimport { openFile, createFile, paste, download, Action } from '../../actions'\r\nimport { StoreState } from '../../reducers'\r\nimport { ThunkDispatch } from 'redux-thunk'\r\n\r\nexport interface AppProps {\r\n  downloadName: string\r\n  onFileCreate: () => void\r\n  onFileOpen: (e: ChangeEvent<HTMLInputElement>) => void\r\n  onPaste: (e: ClipboardEvent) => void\r\n}\r\n\r\nclass _App extends PureComponent<AppProps> {\r\n  render() {\r\n    return (\r\n      <React.Fragment>\r\n        <FileMenu\r\n          onDownload={() => download(this.props.downloadName)}\r\n          onFileCreate={this.props.onFileCreate}\r\n          onFileOpen={this.props.onFileOpen}\r\n        />\r\n        <NavBar>\r\n          <NavBarItem footer=\"Clipboard\">\r\n            <Clipboard />\r\n          </NavBarItem>\r\n          <NavBarItem footer=\"Image\">\r\n            <Image />\r\n          </NavBarItem>\r\n          <NavBarItem footer=\"Instruments\">\r\n            <Instruments />\r\n          </NavBarItem>\r\n          <NavBarItem footer=\"Colors\">\r\n            <ColorsContainer />\r\n          </NavBarItem>\r\n        </NavBar>\r\n        <Canvas />\r\n      </React.Fragment>\r\n    )\r\n  }\r\n\r\n  componentDidMount() {\r\n    document.addEventListener('paste', this.props.onPaste)\r\n  }\r\n\r\n  componentWillUnmount() {\r\n    document.removeEventListener('paste', this.props.onPaste)\r\n  }\r\n}\r\n\r\nconst mapStateToProps = (state: StoreState) => ({\r\n  downloadName: state.image.name\r\n})\r\nconst mapDispatchToProps = (\r\n  dispatch: ThunkDispatch<StoreState, undefined, Action>\r\n) => ({\r\n  onFileCreate: () => dispatch(createFile()),\r\n  onFileOpen: (e: ChangeEvent<HTMLInputElement>) => dispatch(openFile(e)),\r\n  onPaste: (e: ClipboardEvent) => dispatch(paste(e))\r\n})\r\n\r\nexport const App = connect(\r\n  mapStateToProps,\r\n  mapDispatchToProps\r\n)(_App)\r\n","import { ActionTypes } from '../actions'\r\nimport { AnyAction } from 'redux'\r\n\r\nexport const instrumentsReducer = (\r\n  state: any | undefined = { instrument: 'pen' },\r\n  action: AnyAction\r\n) => {\r\n  switch (action.type) {\r\n    case ActionTypes.changeInstrument:\r\n      const { type, ...withoutType } = action\r\n      return { ...state, ...withoutType }\r\n    default:\r\n      return state\r\n  }\r\n}\r\n","import { SelectedColor, ActionTypes } from '../actions'\r\n\r\nimport { combineReducers, AnyAction } from 'redux'\r\n\r\nimport { colorsReducer } from './colors'\r\nimport { instrumentsReducer } from './instruments'\r\n\r\ninterface Color {\r\n  r: number\r\n  g: number\r\n  b: number\r\n}\r\n\r\nexport interface ColorsStoreState {\r\n  list: Color[]\r\n  activeColor: SelectedColor\r\n  primary: number\r\n  secondary: number\r\n}\r\n\r\nexport interface ImageStoreState {\r\n  data: ImageData\r\n  name: string\r\n}\r\n\r\nexport interface StoreState {\r\n  image: ImageStoreState\r\n  colors: ColorsStoreState\r\n  instruments: any // todo fix that\r\n}\r\n\r\nconst canvasReducer = (\r\n  state: ImageStoreState | undefined,\r\n  action: AnyAction\r\n) => {\r\n  if (state === undefined) {\r\n    const canvasEl = document.createElement('canvas')\r\n    ;[canvasEl.width, canvasEl.height] = [800, 450]\r\n    const ctx = canvasEl.getContext('2d')\r\n    if (!ctx) throw new Error(\"Coudn't acquire context\")\r\n    ctx.fillStyle = '#FFFFFF'\r\n    ctx.fillRect(0, 0, canvasEl.width, canvasEl.height)\r\n    return {\r\n      data: ctx.getImageData(0, 0, canvasEl.width, canvasEl.height),\r\n      name: 'Ваша пикча.png'\r\n    }\r\n  }\r\n  switch (action.type) {\r\n    case ActionTypes.changeImage:\r\n      return {\r\n        data: action.data,\r\n        name: action.name || state.name\r\n      }\r\n    default:\r\n      return state\r\n  }\r\n}\r\n\r\nexport const reducer = combineReducers<StoreState>({\r\n  image: canvasReducer,\r\n  colors: colorsReducer,\r\n  instruments: instrumentsReducer\r\n})\r\n\r\nexport default reducer\r\n","import { ActionTypes, SelectedColor } from '../actions'\r\nimport { ColorsStoreState } from '.'\r\nimport { AnyAction } from 'redux'\r\n\r\nexport const colorsReducer = (\r\n  state: ColorsStoreState | undefined = {\r\n    list: [\r\n      { r: 0, g: 0, b: 0 },\r\n      { r: 127, g: 127, b: 127 },\r\n      { r: 136, g: 0, b: 21 },\r\n      { r: 237, g: 28, b: 36 },\r\n      { r: 255, g: 127, b: 39 },\r\n      { r: 255, g: 242, b: 0 },\r\n      { r: 34, g: 177, b: 76 },\r\n      { r: 0, g: 162, b: 232 },\r\n      { r: 63, g: 72, b: 204 },\r\n      { r: 163, g: 73, b: 164 },\r\n      { r: 255, g: 255, b: 255 },\r\n      { r: 195, g: 195, b: 195 },\r\n      { r: 185, g: 122, b: 87 },\r\n      { r: 255, g: 174, b: 201 },\r\n      { r: 255, g: 201, b: 14 },\r\n      { r: 239, g: 228, b: 176 },\r\n      { r: 181, g: 230, b: 29 },\r\n      { r: 153, g: 217, b: 234 },\r\n      { r: 112, g: 176, b: 190 },\r\n      { r: 200, g: 191, b: 231 }\r\n    ],\r\n    activeColor: SelectedColor.primary,\r\n    primary: 0,\r\n    secondary: 10\r\n  },\r\n  action: AnyAction\r\n) => {\r\n  const newState = { ...state }\r\n  switch (action.type) {\r\n    case ActionTypes.selectColor:\r\n      newState[newState.activeColor] = action.index\r\n      return newState\r\n    case ActionTypes.addColor:\r\n      if (newState.list.length !== 30) {\r\n        newState.list = [...newState.list, action.value]\r\n        newState[newState.activeColor] = state.list.length\r\n      } else {\r\n        newState.list = [\r\n          ...newState.list.slice(0, 20),\r\n          ...newState.list.slice(21),\r\n          action.value\r\n        ]\r\n        newState[newState.activeColor] = state.list.length - 1\r\n      }\r\n      return newState\r\n    case ActionTypes.changeActiveColor:\r\n      newState.activeColor = action.activeColor\r\n      return newState\r\n    default:\r\n      return state\r\n  }\r\n}\r\n","import React, { StrictMode } from 'react'\r\nimport { render } from 'react-dom'\r\nimport { Provider } from 'react-redux'\r\nimport { createStore, applyMiddleware, compose } from 'redux'\r\nimport thunk from 'redux-thunk'\r\n\r\nimport { App } from './components/App/App'\r\nimport reducer from './reducers'\r\n\r\ndeclare global {\r\n  interface Window {\r\n    __REDUX_DEVTOOLS_EXTENSION_COMPOSE__: <R>(a: R) => R\r\n  }\r\n}\r\n\r\nconst composeEnhancers = window.__REDUX_DEVTOOLS_EXTENSION_COMPOSE__ || compose\r\nconst store = createStore(reducer, composeEnhancers(applyMiddleware(thunk)))\r\n\r\nrender(\r\n  <StrictMode>\r\n    <Provider store={store}>\r\n      <App />\r\n    </Provider>\r\n  </StrictMode>,\r\n  document.getElementById('root')\r\n)\r\n"],"sourceRoot":""}