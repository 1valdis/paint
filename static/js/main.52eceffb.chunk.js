(window.webpackJsonp=window.webpackJsonp||[]).push([[0],Array(25).concat([function(e,t,n){e.exports=n(57)},,,,,,,,,function(e,t,n){},function(e,t,n){},function(e,t,n){},function(e,t,n){},function(e,t,n){},function(e,t,n){},function(e,t,n){},function(e,t,n){},function(e,t,n){},function(e,t,n){},function(e,t,n){},function(e,t,n){},function(e,t,n){},function(e,t,n){},function(e,t,n){},function(e,t,n){},function(e,t,n){},function(e,t,n){},function(e,t,n){},function(e,t,n){},function(e,t,n){},function(e,t,n){},function(e,t,n){},function(e,t,n){"use strict";n.r(t);var a=n(0),o=n.n(a),i=n(14),r=n(6),s=n(10),c=n(24),l=n(1),h=n(2),u=n(5),p=n(3),d=n(4),g=(n(34),n(35),n(8)),m=n.n(g);var v=function(e){return!!e&&!!(e.offsetWidth||e.offsetHeight||e.getClientRects().length)};function f(e){var t=e.toString(16);return 1===t.length?"0"+t:t}function C(e){var t=e.r,n=e.g,a=e.b;return"#"+f(t)+f(n)+f(a)}function w(e,t,n,a,o){for(var i=Math.abs(n-e),r=Math.abs(a-t),s=e<n?1:-1,c=t<a?1:-1,l=i-r;o(e,t),e!==n||t!==a;){var h=2*l;h>-r&&(l-=r,e+=s),h<i&&(l+=i,t+=c)}}function b(e,t){var n=e.getBoundingClientRect(),a=n.top,o=n.left,i=[t.clientX,t.clientY],r=i[0],s=i[1];return[Math.floor(r-o),Math.floor(s-a)]}n(36);var D=document.getElementById("modal-root"),O=function(e){function t(e){var n;return Object(l.a)(this,t),(n=Object(u.a)(this,Object(p.a)(t).call(this,e))).el=document.createElement("div"),n.el.classList.add("modal"),n}return Object(d.a)(t,e),Object(h.a)(t,[{key:"render",value:function(){return Object(i.createPortal)(this.props.children,this.el)}},{key:"componentDidMount",value:function(){D.appendChild(this.el)}},{key:"componentWillUnmount",value:function(){D.removeChild(this.el)}}]),t}(a.PureComponent),E=(n(37),function(e){return o.a.createElement("div",{className:"about"},o.a.createElement("button",{className:"about-close-button",onClick:e.onClose}),o.a.createElement("p",null,"\u0412\u044b \u0441\u0435\u0440\u044c\u0451\u0437\u043d\u043e \u043e\u0436\u0438\u0434\u0430\u043b\u0438 \u0437\u0434\u0435\u0441\u044c \u0443\u0432\u0438\u0434\u0435\u0442\u044c \u0447\u0442\u043e-\u0442\u043e \u043d\u043e\u0440\u043c\u0430\u043b\u044c\u043d\u043e\u0435? :D"),o.a.createElement("p",null,"\u041d\u0443 \u043b\u0430\u0434\u043d\u043e, \u0432\u043e\u0442 \u043d\u0435\u043c\u043d\u043e\u0433\u043e \u044f\u0437\u044b\u043a\u0430 legalese, \u043f\u043e\u0441\u043a\u043e\u043b\u044c\u043a\u0443 \u0430\u0432\u0442\u043e\u0440\u043e\u0432 \u0438\u043a\u043e\u043d\u043e\u043a \u043d\u0430\u0434\u043e \u0443\u043a\u0430\u0437\u0430\u0442\u044c \u0432 \u044d\u0431\u0430\u0443\u0442\u0435 \u043f\u0440\u043e\u0436\u043a\u0438)))"),o.a.createElement("div",null,"Icons made by ",o.a.createElement("a",{href:"https://www.flaticon.com/authors/good-ware",title:"Good Ware"},"Good Ware"),", ",o.a.createElement("a",{href:"https://www.flaticon.com/authors/smashicons",title:"Smashicons"},"Smashicons"),", ",o.a.createElement("a",{href:"https://www.flaticon.com/authors/pixel-buddha",title:"Pixel Buddha"},"Pixel Buddha"),", ",o.a.createElement("a",{href:"http://www.freepik.com",title:"Freepik"},"Freepik"),", ",o.a.createElement("a",{href:"https://www.flaticon.com/authors/dimitry-miroliubov",title:"Dimitry Miroliubov"},"Dimitry Miroliubov")," from ",o.a.createElement("a",{href:"https://www.flaticon.com/",title:"Flaticon"},"www.flaticon.com")," is licensed by ",o.a.createElement("a",{href:"http://creativecommons.org/licenses/by/3.0/",title:"Creative Commons BY 3.0"},"CC 3.0 BY")))}),y=function(e){function t(){var e,n;Object(l.a)(this,t);for(var o=arguments.length,i=new Array(o),r=0;r<o;r++)i[r]=arguments[r];return(n=Object(u.a)(this,(e=Object(p.a)(t)).call.apply(e,[this].concat(i)))).menu=Object(a.createRef)(),n}return Object(d.a)(t,e),Object(h.a)(t,[{key:"render",value:function(){return o.a.createElement("div",{ref:this.menu,className:m()("file-menu",{"file-menu_open":this.props.isOpen})},o.a.createElement("button",{className:"file-menu-button",onClick:this.props.onClick},"\u0424\u0430\u0439\u043b"),o.a.createElement("nav",{className:"file-menu-items",onClick:this.props.onClickInside},o.a.createElement("button",{className:"file-menu-item",onClick:this.props.onFileCreate},"\u0421\u043e\u0437\u0434\u0430\u0442\u044c"),o.a.createElement("label",{className:"file-menu-item"},"\u041e\u0442\u043a\u0440\u044b\u0442\u044c",o.a.createElement("input",{type:"file",className:"file-menu-item",accept:"image/*",onChange:this.props.onFileOpen})),o.a.createElement("button",{className:"file-menu-item",onClick:this.props.onDownload},"\u0421\u043e\u0445\u0440\u0430\u043d\u0438\u0442\u044c"),o.a.createElement("button",{className:"file-menu-item",onClick:this.props.onAboutOpen},"\u041e \u043f\u0440\u043e\u0433\u0440\u0430\u043c\u043c\u0435")),this.props.isAboutOpen&&o.a.createElement(O,null,o.a.createElement(E,{onClose:this.props.onAboutClose})))}},{key:"componentDidMount",value:function(){this.clickOutsideListener=function(e,t){var n=function(n){e.contains(n.target)||v(e)&&t()};return document.addEventListener("click",n),n}(this.menu.current,this.props.onClickOutside)}},{key:"componentWillUnmount",value:function(){var e;e=this.clickOutsideListener,document.removeEventListener("click",e)}}]),t}(a.PureComponent),x=function(e){function t(){var e;return Object(l.a)(this,t),(e=Object(u.a)(this,Object(p.a)(t).call(this))).toggleMenu=function(){return e.setState(function(e){return{open:!e.open}})},e.closeMenu=function(){return e.setState({open:!1})},e.openAbout=function(){return e.setState({aboutOpen:!0})},e.closeAbout=function(){return e.setState({aboutOpen:!1})},e.state={open:!1,aboutOpen:!1},e}return Object(d.a)(t,e),Object(h.a)(t,[{key:"render",value:function(){var e=this;return o.a.createElement(y,Object.assign({isOpen:this.state.open,onClick:this.toggleMenu,onClickOutside:this.closeMenu,onClickInside:this.closeMenu,isAboutOpen:this.state.aboutOpen,onAboutOpen:this.openAbout,onAboutClose:this.closeAbout},this.props,{onDownload:function(){return e.props.onDownload(e.props.downloadName)}}))}}]),t}(a.PureComponent),z={CHANGE_INSTRUMENT:"instruments/change"};function k(e){return{type:z.CHANGE_INSTRUMENT,instrument:e}}var j={IMAGE_CHANGED:"app/image-changed"},R=document.createElement("canvas"),M=R.getContext("2d",{alpha:!1}),P=null;function I(){return function(e,t){var n=[800,450];R.width=n[0],R.height=n[1],M.fillStyle="#FFFFFF",M.fillRect(0,0,R.width,R.height),e({type:j.IMAGE_CHANGED,data:M.getImageData(0,0,R.width,R.height),name:"\u0412\u0430\u0448\u0430 \u043f\u0438\u043a\u0447\u0430.png"})}}function L(e){return function(t,n){R.width=e.width,R.height=e.height,M.putImageData(e,0,0),t({type:j.IMAGE_CHANGED,data:e})}}n(38);var S=n(12),N=(n(39),function(e){function t(){var e,n;Object(l.a)(this,t);for(var o=arguments.length,i=new Array(o),r=0;r<o;r++)i[r]=arguments[r];return(n=Object(u.a)(this,(e=Object(p.a)(t)).call.apply(e,[this].concat(i)))).handlePointerDown=function(e){switch(e.button){case 0:return void(n.resizerElement.current.contains(e.target)&&(n.resizing=!0,n.props.onResizeStart(e)));case 2:n.resizing=!1,n.props.onResizeCancel(e)}},n.handlePointerUp=function(e){n.resizing&&(n.props.onResizeEnd(e),n.resizing=!1)},n.handlePointerMove=function(e){if(n.resizing)switch(e.buttons){case 1:n.props.onResizeMove(e);break;case 2:case 3:n.resizing=!1,n.props.onResizeCancel(e),n.preventContextMenu=!0}},n.handlePointerCancel=function(e){n.resizing&&(n.resizing=!1,n.props.onResizeCancel(e))},n.handleDragStart=function(e){e.preventDefault()},n.handleContextMenu=function(e){n.preventContextMenu&&(e.preventDefault(),n.preventContextMenu=!1)},n.resizing=!1,n.preventContextMenu=!1,n.resizerElement=Object(a.createRef)(),n}return Object(d.a)(t,e),Object(h.a)(t,[{key:"render",value:function(){return o.a.createElement("div",{className:"resizer-outer "+(this.props.className||""),style:Object(S.a)({},this.props.outerStyle),ref:this.resizerElement},o.a.createElement("div",{className:"resizer-inner",style:Object(S.a)({},this.props.innerStyle)}))}},{key:"componentDidMount",value:function(){document.addEventListener("pointerdown",this.handlePointerDown,{passive:!0}),document.addEventListener("pointermove",this.handlePointerMove,{passive:!0}),document.addEventListener("pointerup",this.handlePointerUp,{passive:!0}),document.addEventListener("pointercancel",this.handlePointerCancel,{passive:!0}),window.addEventListener("blur",this.handlePointerCancel,{passive:!0}),document.addEventListener("contextmenu",this.handleContextMenu),document.addEventListener("dragstart",this.handleDragStart)}},{key:"componentWillUnmount",value:function(){document.removeEventListener("pointerdown",this.handlePointerDown,{passive:!0}),document.removeEventListener("pointermove",this.handlePointerMove,{passive:!0}),document.removeEventListener("pointerup",this.handlePointerUp,{passive:!0}),document.removeEventListener("pointercancel",this.handlePointerCancel,{passive:!0}),window.removeEventListener("blur",this.handlePointerCancel,{passive:!0}),document.removeEventListener("contextmenu",this.handleContextMenu),document.removeEventListener("dragstart",this.handleDragStart)}}]),t}(a.Component)),A={canvas:["e","se","s"],selection:["n","ne","e","se","s","sw","w","nw"]},X=function(e){function t(){var e,n;Object(l.a)(this,t);for(var o=arguments.length,i=new Array(o),r=0;r<o;r++)i[r]=arguments[r];return(n=Object(u.a)(this,(e=Object(p.a)(t)).call.apply(e,[this].concat(i)))).state={resizing:!1,resizeTop:n.props.top,resizeLeft:n.props.left,resizeWidth:n.props.width,resizeHeight:n.props.height},n.resizeRect=Object(a.createRef)(),n}return Object(d.a)(t,e),Object(h.a)(t,[{key:"render",value:function(){var e=this;return o.a.createElement("div",{className:m()("resizer",{resizer_resizing:this.state.resizing,"resizer_hide-border":this.props.hideBorderOnResizing}),ref:this.resizeRect,style:{width:"".concat(this.state.resizing?this.state.resizeWidth:this.props.width,"px"),height:"".concat(this.state.resizing?this.state.resizeHeight:this.props.height,"px"),top:"".concat(this.state.resizing?this.state.resizeTop:this.props.top,"px"),left:"".concat(this.state.resizing?this.state.resizeLeft:this.props.left,"px")}},A[this.props.mode].map(function(t){return o.a.createElement(N,{onResizeStart:e.onResizeStart.bind(e,t),onResizeMove:e.onResizeMove.bind(e,t),onResizeEnd:e.onResizeEnd.bind(e,t),onResizeCancel:e.onResizeCancel.bind(e,t),key:"".concat(t,"-resizer-point"),className:t})}))}},{key:"onResizeStart",value:function(e,t){}},{key:"onResizeMove",value:function(e,t){var n=this.resizeRect.current.getBoundingClientRect(),a=n.top,o=n.left,i=n.bottom,r=n.right,s=this.resizeRect.current.parentNode.getBoundingClientRect(),c=[a+window.pageYOffset,o+window.pageXOffset,i+window.pageYOffset,r+window.pageXOffset];a=c[0],o=c[1],i=c[2],r=c[3];var l=t.clientX+window.pageXOffset,h=t.clientY+window.pageYOffset,u={resizing:!0,resizeTop:this.props.top,resizeLeft:this.props.left,resizeWidth:this.props.width,resizeHeight:this.props.height};switch(e){case"n":u.resizeTop=h-s.top,u.resizeHeight=this.props.height-u.resizeTop;break;case"ne":u.resizeTop=h-s.top,u.resizeHeight=this.props.height-u.resizeTop,u.resizeWidth=l-o;break;case"e":u.resizeWidth=l-o;break;case"se":u.resizeHeight=h-a,u.resizeWidth=l-o;break;case"s":u.resizeHeight=h-a;break;case"sw":u.resizeHeight=h-a,u.resizeLeft=l-s.left,u.resizeWidth=this.props.width-u.resizeLeft;break;case"w":u.resizeLeft=l-s.left,u.resizeWidth=this.props.width-u.resizeLeft;break;case"nw":u.resizeTop=h-s.top,u.resizeHeight=this.props.height-u.resizeTop,u.resizeLeft=l-s.left,u.resizeWidth=this.props.width-u.resizeLeft}u.resizeTop=Math.round(u.resizeTop+window.pageYOffset>this.props.top+this.props.height-1?this.props.height+this.props.top-1:u.resizeTop),u.resizeLeft=Math.round(u.resizeLeft+window.pageXOffset>this.props.left+this.props.width-1?this.props.width+this.props.left-1:u.resizeLeft),u.resizeWidth=Math.round(u.resizeWidth>0?u.resizeWidth:1),u.resizeHeight=Math.round(u.resizeHeight>0?u.resizeHeight:1),this.props.onResizing&&this.props.onResizing(u.resizeTop,u.resizeLeft,u.resizeWidth,u.resizeHeight),this.setState(u)}},{key:"onResizeEnd",value:function(e,t){this.props.onResizeEnd&&this.props.onResizeEnd(this.state.resizeTop,this.state.resizeLeft,this.state.resizeWidth,this.state.resizeHeight),this.setState({resizing:!1})}},{key:"onResizeCancel",value:function(e,t){this.setState({resizing:!1,resizeWidth:this.props.width,resizeHeight:this.props.height})}}],[{key:"getDerivedStateFromProps",value:function(e){return(arguments.length>1&&void 0!==arguments[1]?arguments[1]:{resizing:!1}).resizing?null:{resizeTop:e.top,resizeLeft:e.left,resizeWidth:e.width,resizeHeight:e.height}}}]),t}(a.PureComponent),Y=n(15),U=(n(40),function(e){function t(){var e,n;Object(l.a)(this,t);for(var a=arguments.length,o=new Array(a),i=0;i<a;i++)o[i]=arguments[i];return(n=Object(u.a)(this,(e=Object(p.a)(t)).call.apply(e,[this].concat(o)))).onResizeEnd=function(e,t,a,o){n.props.onResizeEnd({top:n.props.top+e,left:n.props.left+t,width:a,height:o})},n.onResizing=function(e,t,a,o){n.props.onResizing({top:n.props.top+e,left:n.props.left+t,width:a,height:o})},n.handlePointerDown=function(e){e.target===e.currentTarget&&n.setState({moving:!0,startX:e.clientX+window.pageXOffset,startY:e.clientY+window.pageYOffset})},n.handleDocumentPointerMove=function(e){if(n.state.moving&&null!==n.state.startX&&n.props.onMoving)switch(e.buttons){case 1:var t=n.props,a=(t.onResizeEnd,t.onResizing,t.onMoveEnd,t.onMoving,Object(Y.a)(t,["onResizeEnd","onResizing","onMoveEnd","onMoving"]));a.top=n.state.top+(e.clientY+window.pageYOffset-n.state.startY),a.left=n.state.left+(e.clientX+window.pageXOffset-n.state.startX),n.props.onMoving(a);break;case 2:case 3:n.props.onMoving({top:n.state.top,left:n.state.left,width:n.props.width,height:n.props.height}),n.setState({moving:!1}),n.preventContextMenu=!0}},n.handleDocumentPointerUp=function(e){if(n.state.moving&&null!==n.state.startX&&n.props.onMoving){var t=n.props,a=(t.onResizeEnd,t.onResizing,t.onMoveEnd,t.onMoving,Object(Y.a)(t,["onResizeEnd","onResizing","onMoveEnd","onMoving"]));a.top=n.state.top+(e.clientY+window.pageYOffset-n.state.startY),a.left=n.state.left+(e.clientX+window.pageXOffset-n.state.startX),n.props.onMoveEnd(a)}n.setState({moving:!1,startX:null,startY:null})},n.handleContextMenu=function(e){n.preventContextMenu&&(e.preventDefault(),n.preventContextMenu=!1)},n.state={moving:!1,startX:null,startY:null,top:n.props.top,left:n.props.left},n}return Object(d.a)(t,e),Object(h.a)(t,[{key:"render",value:function(){var e=this.props,t=(e.onResizeEnd,e.onResizing,e.onMoveEnd,e.onMoving,Object(Y.a)(e,["onResizeEnd","onResizing","onMoveEnd","onMoving"]));return this.props.onResizing&&(t.onResizing=this.onResizing),this.props.onResizeEnd&&(t.onResizeEnd=this.onResizeEnd),o.a.createElement("div",{style:this.props,onPointerDown:this.handlePointerDown,className:"movable-selection"},o.a.createElement(X,Object.assign({mode:"selection"},t,{top:0,left:0})))}},{key:"componentDidMount",value:function(){document.addEventListener("pointermove",this.handleDocumentPointerMove,{passive:!0}),document.addEventListener("pointerup",this.handleDocumentPointerUp,{passive:!0}),document.addEventListener("contextmenu",this.handleContextMenu)}},{key:"componentWillUnmount",value:function(){document.removeEventListener("pointermove",this.handleDocumentPointerUp,{passive:!0}),document.removeEventListener("pointerup",this.handleDocumentPointerUp,{passive:!0}),document.removeEventListener("contextmenu",this.handleContextMenu)}}]),t}(a.PureComponent));U.getDerivedStateFromProps=function(e,t){return t.moving?null:{top:e.top,left:e.left}};var T=U,_=function(e){function t(){var e,n;Object(l.a)(this,t);for(var o=arguments.length,i=new Array(o),r=0;r<o;r++)i[r]=arguments[r];return(n=Object(u.a)(this,(e=Object(p.a)(t)).call.apply(e,[this].concat(i)))).handleResizing=function(e){e.top,e.left,e.width,e.height},n.handleResizeEnd=function(e){var t=e.top,a=e.left,o=e.width,i=e.height;n.backgroundColor||(n.backgroundColor=n.props.secondaryColor,n.newCtx.fillStyle="rgb(".concat(n.backgroundColor.r,", ").concat(n.backgroundColor.g,", ").concat(n.backgroundColor.b,")")),n.props.onCoordsChanged({top:t,left:a,width:o,height:i}),n.props.onImageChanged(n.newCtx.getImageData(0,0,n.newCtx.canvas.width,n.newCtx.canvas.height))},n.handleMoving=function(e){var t=e.top,a=e.left,o=e.width,i=e.height;n.backgroundColor||(n.backgroundColor=n.props.secondaryColor,n.newCtx.fillStyle="rgb(".concat(n.backgroundColor.r,", ").concat(n.backgroundColor.g,", ").concat(n.backgroundColor.b,")")),n.props.onCoordsChanged({top:t,left:a,width:o,height:i})},n.handleMoveEnd=function(e){e.top,e.left,e.width,e.height;n.props.onImageChanged(n.newCtx.getImageData(0,0,n.newCtx.canvas.width,n.newCtx.canvas.height))},n.redrawCanvas=function(e){e&&(n.oldCtx.canvas.width=n.props.imageData.width,n.oldCtx.canvas.height=n.props.imageData.height,n.newCtx.canvas.width=n.props.imageData.width,n.newCtx.canvas.height=n.props.imageData.height,n.newCtx.imageSmoothingEnabled=!1,n.oldCtx.putImageData(n.props.imageData,0,0)),n.newCtx.drawImage(n.oldCtx.canvas,0,0),n.props.coords&&n.state.originCoords&&(n.newCtx.fillRect(n.state.originCoords.left,n.state.originCoords.top,n.state.originCoords.width,n.state.originCoords.height),n.newCtx.drawImage(n.oldCtx.canvas,n.state.originCoords.left,n.state.originCoords.top,n.state.originCoords.width,n.state.originCoords.height,n.props.coords.left,n.props.coords.top,n.props.coords.width,n.props.coords.height))},n.canvasRef=Object(a.createRef)(),n.state={originCoords:n.props.coords},n}return Object(d.a)(t,e),Object(h.a)(t,[{key:"render",value:function(){var e=this;return o.a.createElement(a.Fragment,null,o.a.createElement("canvas",{ref:this.canvasRef,onPointerDown:function(t){return t.target===t.currentTarget&&e.props.onClickOutside(t)}}),o.a.createElement(T,Object.assign({},this.props.coords,{onResizing:this.handleResizing,onResizeEnd:this.handleResizeEnd,onMoving:this.handleMoving,onMoveEnd:this.handleMoveEnd,hideBorderOnResizing:!1})))}},{key:"componentDidMount",value:function(){var e=document.createElement("canvas");e.width=this.props.imageData.width,e.height=this.props.imageData.height,this.oldCtx=e.getContext("2d"),this.oldCtx.putImageData(this.props.imageData,0,0),this.canvasRef.current.width=this.props.imageData.width,this.canvasRef.current.height=this.props.imageData.height,this.newCtx=this.canvasRef.current.getContext("2d"),this.newCtx.imageSmoothingEnabled=!1}},{key:"componentDidUpdate",value:function(e){this.redrawCanvas(!1)}}]),t}(a.PureComponent),F=function(e){function t(){var e,n;Object(l.a)(this,t);for(var o=arguments.length,i=new Array(o),r=0;r<o;r++)i[r]=arguments[r];return(n=Object(u.a)(this,(e=Object(p.a)(t)).call.apply(e,[this].concat(i)))).updateOldCanvas=function(){if(!n.oldCtx){var e=document.createElement("canvas");n.oldCtx=e.getContext("2d")}n.oldCtx.canvas.width=n.props.imageData.width,n.oldCtx.canvas.height=n.props.imageData.height,n.oldCtx.putImageData(n.props.imageData,0,0)},n.updateSelectionCanvas=function(){if(!n.selectionCtx){var e=document.createElement("canvas");n.selectionCtx=e.getContext("2d")}n.selectionCtx.canvas.width=n.props.selectionImageData.width,n.selectionCtx.canvas.height=n.props.selectionImageData.height,n.selectionCtx.putImageData(n.props.selectionImageData,0,0)},n.updateNewCanvas=function(){n.newCtx||(n.canvasRef.current.width=n.oldCtx.canvas.width,n.canvasRef.current.height=n.oldCtx.canvas.height,n.newCtx=n.canvasRef.current.getContext("2d"),n.newCtx.imageSmoothingEnabled=!1),n.newCtx.canvas.width===n.oldCtx.canvas.width&&n.newCtx.canvas.height===n.oldCtx.canvas.height||(n.newCtx.canvas.width=n.oldCtx.canvas.width,n.newCtx.canvas.height=n.oldCtx.canvas.height,n.newCtx.imageSmoothingEnabled=!1),n.newCtx.drawImage(n.oldCtx.canvas,0,0),n.newCtx.drawImage(n.selectionCtx.canvas,0,0,n.selectionCtx.canvas.width,n.selectionCtx.canvas.height,n.props.coords.left,n.props.coords.top,n.props.coords.width,n.props.coords.height)},n.handleResizing=function(e){e.top,e.left,e.width,e.height},n.handleResizeEnd=function(e){var t=e.top,a=e.left,o=e.width,i=e.height;n.backgroundColor||(n.backgroundColor=n.props.secondaryColor,n.newCtx.fillStyle="rgb(".concat(n.backgroundColor.r,", ").concat(n.backgroundColor.g,", ").concat(n.backgroundColor.b,")")),n.updateOld=!1,n.props.onSelectionChanged({coords:{top:t,left:a,width:o,height:i},imageData:n.props.selectionImageData}),n.updateOld=!1,n.props.onImageChanged(n.newCtx.getImageData(0,0,n.newCtx.canvas.width,n.newCtx.canvas.height))},n.handleMoving=function(e){var t=e.top,a=e.left,o=e.width,i=e.height;n.backgroundColor||(n.backgroundColor=n.props.secondaryColor,n.newCtx.fillStyle="rgb(".concat(n.backgroundColor.r,", ").concat(n.backgroundColor.g,", ").concat(n.backgroundColor.b,")")),n.updateOld=!1,n.props.onSelectionChanged({coords:{top:t,left:a,width:o,height:i},imageData:n.props.selectionImageData})},n.handleMoveEnd=function(e){e.top,e.left,e.width,e.height;n.updateOld=!1,n.props.onImageChanged(n.newCtx.getImageData(0,0,n.newCtx.canvas.width,n.newCtx.canvas.height))},n.resizeCanvasToFitPasted=function(){var e=document.createElement("canvas");e.width=Math.max(n.props.imageData.width,n.props.selectionImageData.width),e.height=Math.max(n.props.imageData.height,n.props.selectionImageData.height);var t=e.getContext("2d");t.fillStyle="rgb(".concat(n.props.secondaryColor.r,", ").concat(n.props.secondaryColor.g,", ").concat(n.props.secondaryColor.b,")"),t.fillRect(0,0,t.canvas.width,t.canvas.height),t.putImageData(n.props.imageData,0,0),n.props.onImageChanged(t.getImageData(0,0,t.canvas.width,t.canvas.height))},n.canvasRef=Object(a.createRef)(),(n.props.imageData.width<n.props.selectionImageData.width||n.props.imageData.height<n.props.selectionImageData.height)&&(n.resized=!0,n.resizeCanvasToFitPasted(),n.props.onSelectionChanged({coords:n.props.coords,imageData:n.props.selectionImageData}),n.updateOld=!0),n}return Object(d.a)(t,e),Object(h.a)(t,[{key:"render",value:function(){var e=this;return o.a.createElement(a.Fragment,null,o.a.createElement("canvas",{ref:this.canvasRef,onPointerDown:function(t){return t.target===t.currentTarget&&e.props.onClickOutside(t)}}),o.a.createElement(T,Object.assign({},this.props.coords,{onResizing:this.handleResizing,onResizeEnd:this.handleResizeEnd,onMoving:this.handleMoving,onMoveEnd:this.handleMoveEnd,hideBorderOnResizing:!1})))}},{key:"componentDidMount",value:function(){this.updateOldCanvas(),this.updateSelectionCanvas(),this.updateNewCanvas(),this.props.onImageChanged(this.newCtx.getImageData(0,0,this.newCtx.canvas.width,this.newCtx.canvas.height))}},{key:"componentDidUpdate",value:function(e){if(this.updateOld&&this.updateOldCanvas(),this.props.selectionImageData!==e.selectionImageData&&this.updateSelectionCanvas(),this.updateNewCanvas(),this.resized)return this.resized=!1,this.props.onImageChanged(this.newCtx.getImageData(0,0,this.newCtx.canvas.width,this.newCtx.canvas.height)),void(this.updateOld=!1);this.updateOld=!0,this.props.selectionImageData!==e.selectionImageData&&this.props.onImageChanged(this.newCtx.getImageData(0,0,this.newCtx.canvas.width,this.newCtx.canvas.height))}}]),t}(a.PureComponent),H=(n(41),function(e){function t(){var e,n;Object(l.a)(this,t);for(var o=arguments.length,i=new Array(o),r=0;r<o;r++)i[r]=arguments[r];return(n=Object(u.a)(this,(e=Object(p.a)(t)).call.apply(e,[this].concat(i)))).handlePointerDown=function(e,t){if(e.target===e.currentTarget||t){n.backgroundColor=null,n.props.changeSelection({coords:null,imageData:null});var a=n.containerRef.current.getBoundingClientRect(),o=a.top,i=a.left,r=a.bottom,s=a.right,c=[o+window.pageYOffset,i+window.pageXOffset,r+window.pageYOffset,s+window.pageXOffset];o=c[0],i=c[1],r=c[2],s=c[3];var l=e.clientX+window.pageXOffset,h=e.clientY+window.pageYOffset,u=[Math.ceil(h-o),Math.ceil(l-i)];o=u[0],i=u[1],n.setState({selecting:!0,selectingY:o,selectingX:i,selectingCoords:null})}},n.handleDocumentPointerMove=function(e){if(n.state.selecting)switch(e.buttons){case 1:n.setState(function(t){var a=n.containerRef.current.getBoundingClientRect(),o=a.top,i=a.left,r=a.bottom,s=a.right,c=[o+window.pageYOffset,i+window.pageXOffset,r+window.pageYOffset,s+window.pageXOffset];o=c[0],i=c[1],r=c[2],s=c[3];var l=e.clientX+window.pageXOffset,h=e.clientY+window.pageYOffset,u=[Math.trunc(h-o),Math.trunc(l-i)],p=u[0],d=u[1],g=[Math.max(0,Math.min(p,n.props.imageData.height)),Math.max(0,Math.min(d,n.props.imageData.width))];return p=g[0],d=g[1],{selectingCoords:{top:Math.min(t.selectingY,p),left:Math.min(t.selectingX,d),width:Math.max(Math.max(t.selectingX,d)-Math.min(t.selectingX,d),0),height:Math.max(Math.max(t.selectingY,p)-Math.min(t.selectingY,p),0)}}});break;case 2:case 3:n.setState({selecting:!1,selectingX:null,selectingY:null,selectingCoords:null}),n.preventContextMenu=!0}},n.handleDocumentPointerUp=function(e){n.setState(function(e){var t=null;return e.selecting&&n.state.selectingCoords?(n.state.selectingCoords.width>0&&n.state.selectingCoords.height>0&&(n.props.changeSelection({coords:n.state.selectingCoords,imageData:null}),t=n.state.selectingCoords),{selecting:!1,selectingX:null,selectingY:null,selectingCoords:null,selectionOriginCoords:t}):{selecting:!1,selectingX:null,selectingY:null}})},n.handleContextMenu=function(e){n.preventContextMenu&&(e.preventDefault(),n.preventContextMenu=!1)},n.state={selecting:!1,selectingX:null,selectingY:null,selectingCoords:null},n.containerRef=Object(a.createRef)(),n}return Object(d.a)(t,e),Object(h.a)(t,[{key:"render",value:function(){var e,t=this;return e=this.state.selecting&&this.state.selectingCoords?o.a.createElement("div",{className:"selecting",style:{top:"".concat(this.state.selectingCoords.top,"px"),left:"".concat(this.state.selectingCoords.left,"px"),width:"".concat(this.state.selectingCoords.width,"px"),height:"".concat(this.state.selectingCoords.height,"px")}}):this.props.selectionImageData?o.a.createElement(F,{onClickOutside:function(e){return t.handlePointerDown(e,!0)},imageData:this.props.imageData,coords:this.props.selectionCoords,selectionImageData:this.props.selectionImageData,onSelectionChanged:this.props.changeSelection,onImageChanged:function(e){return t.props.changeImage(e)},secondaryColor:this.props.secondaryColor}):this.props.selectionCoords?o.a.createElement(_,{onClickOutside:function(e){return t.handlePointerDown(e,!0)},imageData:this.props.imageData,coords:this.props.selectionCoords,onCoordsChanged:function(e){return t.props.changeSelection({coords:e,imageData:null})},onImageChanged:function(e){return t.props.changeImage(e)},secondaryColor:this.props.secondaryColor}):null,o.a.createElement("div",{className:"selection",onPointerDown:this.handlePointerDown,ref:this.containerRef},e)}},{key:"componentDidMount",value:function(){document.addEventListener("pointermove",this.handleDocumentPointerMove,{passive:!0}),document.addEventListener("pointerup",this.handleDocumentPointerUp,{passive:!0}),document.addEventListener("contextmenu",this.handleContextMenu)}},{key:"componentWillUnmount",value:function(){document.removeEventListener("pointermove",this.handleDocumentPointerMove,{passive:!0}),document.removeEventListener("pointerup",this.handleDocumentPointerUp,{passive:!0}),document.removeEventListener("contextmenu",this.handleContextMenu)}}]),t}(a.PureComponent)),W=Object(r.b)(function(e){return{imageData:e.image.data,selectionCoords:e.instruments.selection?e.instruments.selection.coords:null,selectionImageData:e.instruments.selection?e.instruments.selection.imageData:null,secondaryColor:e.colors.list[e.colors.secondary]}},function(e){return{changeSelection:function(t,n){return e(function(e){var t=e.coords,n=e.imageData;return{type:z.CHANGE_INSTRUMENT,instrument:"selection",selection:{coords:t,imageData:n}}}(t))},changeImage:function(t){return e(L(t))}}})(H),G=n(11),B=n(7),J=(n(42),function(e){function t(){var e,n;Object(l.a)(this,t);for(var o=arguments.length,i=new Array(o),r=0;r<o;r++)i[r]=arguments[r];return(n=Object(u.a)(this,(e=Object(p.a)(t)).call.apply(e,[this].concat(i)))).handlePointerDown=function(e){var t;n.isDrawing=!0,(t=n).beginDrawing.apply(t,Object(B.a)(b(n.canvasRef.current,e)))},n.handlePointerMove=function(e){var t;n.isDrawing&&3!==e.buttons&&(t=n).continueDrawing.apply(t,Object(B.a)(b(n.canvasRef.current,e)))},n.handlePointerEnter=function(e){var t;1===e.buttons&&n.isDrawing?(t=n).continueDrawing.apply(t,Object(B.a)(b(n.canvasRef.current,e))):n.isDrawing=!1},n.handlePointerLeave=function(e){var t;n.isDrawing&&(t=n).continueDrawing.apply(t,Object(B.a)(b(n.canvasRef.current,e)))},n.handleDocumentPointerUp=function(){n.isDrawing&&(n.isDrawing=!1,n.endDrawing())},n.handleDocumentPointerMove=function(e){if(e.target!==n.canvasRef.current){var t=b(n.canvasRef.current,e),a=Object(G.a)(t,2);n.prevX=a[0],n.prevY=a[1]}n.isDrawing&&2===e.button&&(n.preventContextMenu=!0,n.cancelDrawing())},n.handleDocumentContextMenu=function(e){n.isDrawing&&(e.preventDefault(),n.isDrawing=!1)},n.handleDocumentSelectStart=function(e){n.isDrawing&&e.preventDefault()},n.beginDrawing=function(e,t){var a=n.props.color,o=a.r,i=a.g,r=a.b;n.ctx.fillStyle="rgb(".concat(o,",").concat(i,",").concat(r,")"),n.ctx.fillRect(e,t,1,1);var s=[e,t];n.prevX=s[0],n.prevY=s[1]},n.continueDrawing=function(e,t){w(n.prevX,n.prevY,e,t,n.drawPoint);var a=[e,t];n.prevX=a[0],n.prevY=a[1]},n.endDrawing=function(){n.props.dispatch(L(n.ctx.getImageData(0,0,n.canvasRef.current.width,n.canvasRef.current.height)))},n.cancelDrawing=function(){n.ctx.putImageData(n.props.imageData,0,0)},n.drawPoint=function(e,t){n.ctx.fillRect(e,t,1,1)},n.isDrawing=!1,n.prevX=0,n.prevY=0,n.canvasRef=Object(a.createRef)(),n.ctx=void 0,n}return Object(d.a)(t,e),Object(h.a)(t,[{key:"render",value:function(){return o.a.createElement("canvas",{className:"pen-canvas",ref:this.canvasRef,width:this.props.imageData?this.props.imageData.width:0,height:this.props.imageData?this.props.imageData.height:0,onPointerDown:this.handlePointerDown,onPointerUp:this.handlePointerUp,onPointerMove:this.handlePointerMove,onPointerEnter:this.handlePointerEnter,onPointerLeave:this.handlePointerLeave})}},{key:"componentDidMount",value:function(){this.ctx=this.canvasRef.current.getContext("2d"),null!=this.props.imageData&&this.ctx.putImageData(this.props.imageData,0,0),document.addEventListener("pointerup",this.handleDocumentPointerUp),document.addEventListener("pointermove",this.handleDocumentPointerMove),document.addEventListener("selectstart",this.handleDocumentSelectStart),document.addEventListener("contextmenu",this.handleDocumentContextMenu)}},{key:"componentWillUnmount",value:function(){document.removeEventListener("pointerup",this.handleDocumentPointerUp),document.removeEventListener("pointermove",this.handleDocumentPointerMove),document.removeEventListener("selectstart",this.handleDocumentSelectStart),document.removeEventListener("contextmenu",this.handleDocumentContextMenu)}},{key:"componentDidUpdate",value:function(){null!=this.props.imageData&&this.ctx.putImageData(this.props.imageData,0,0)}}]),t}(a.PureComponent)),V=Object(r.b)(function(e){return{color:e.colors.list[e.colors.primary],imageData:e.image.data}})(J),Z=(n(43),function(e){function t(){var e,n;Object(l.a)(this,t);for(var o=arguments.length,i=new Array(o),r=0;r<o;r++)i[r]=arguments[r];return(n=Object(u.a)(this,(e=Object(p.a)(t)).call.apply(e,[this].concat(i)))).handleMouseDown=function(e){var t=b(n.canvasRef.current,e),a=Object(G.a)(t,2),o=a[0],i=a[1],r=n.ctx.getImageData(0,0,n.canvasRef.current.width,n.canvasRef.current.height);n.floodFill(r,o,i,{r:r.data[4*(i*r.width+o)],g:r.data[4*(i*r.width+o)+1],b:r.data[4*(i*r.width+o)+2]},n.props.color),n.props.dispatch(L(r))},n.floodFill=function(e,t,n,a,o){var i=a.r,r=a.g,s=a.b,c=o.r,l=o.g,h=o.b,u=4*(n*e.width+t);if(i===e.data[u]&&r===e.data[u+1]&&s===e.data[u+2]&&(i!==c||r!==l||s!==h)){var p=[];for(e.data[u]=c,e.data[u+1]=l,e.data[u+2]=h,p.push([t,n]);0!==p.length;){var d=p.shift(),g=4*(d[1]*e.width+d[0]);d[0]>0&&i===e.data[g-4]&&r===e.data[g-3]&&s===e.data[g-2]&&(e.data[g-4]=c,e.data[g-3]=l,e.data[g-2]=h,p.push([d[0]-1,d[1]])),d[0]<e.width-1&&i===e.data[g+4]&&r===e.data[g+5]&&s===e.data[g+6]&&(e.data[g+4]=c,e.data[g+5]=l,e.data[g+6]=h,p.push([d[0]+1,d[1]])),d[1]>0&&i===e.data[g-4*e.width]&&r===e.data[g-4*e.width+1]&&s===e.data[g-4*e.width+2]&&(e.data[g-4*e.width]=c,e.data[g-4*e.width+1]=l,e.data[g-4*e.width+2]=h,p.push([d[0],d[1]-1])),d[1]<e.height-1&&i===e.data[g+4*e.width]&&r===e.data[g+4*e.width+1]&&s===e.data[g+4*e.width+2]&&(e.data[g+4*e.width]=c,e.data[g+4*e.width+1]=l,e.data[g+4*e.width+2]=h,p.push([d[0],d[1]+1]))}}},n.canvasRef=Object(a.createRef)(),n}return Object(d.a)(t,e),Object(h.a)(t,[{key:"render",value:function(){return o.a.createElement("canvas",{className:"fill-canvas",ref:this.canvasRef,width:this.props.imageData?this.props.imageData.width:0,height:this.props.imageData?this.props.imageData.height:0,onMouseDown:this.handleMouseDown})}},{key:"componentDidMount",value:function(){this.ctx=this.canvasRef.current.getContext("2d"),null!=this.props.imageData&&this.ctx.putImageData(this.props.imageData,0,0)}},{key:"componentDidUpdate",value:function(){this.ctx.putImageData(this.props.imageData,0,0)}}]),t}(a.PureComponent)),q=Object(r.b)(function(e){return{color:e.colors.list[e.colors.primary],imageData:e.image.data}})(Z),K={ADD_COLOR:"colors/add",SELECT_COLOR:"colors/select",CHANGE_ACTIVE_COLOR:"colors/change-active"};function Q(e){return{type:K.SELECT_COLOR,index:e}}n(44);var $=function(e){function t(){var e,n;Object(l.a)(this,t);for(var a=arguments.length,o=new Array(a),i=0;i<a;i++)o[i]=arguments[i];return(n=Object(u.a)(this,(e=Object(p.a)(t)).call.apply(e,[this].concat(o)))).handleClick=function(e){if(e.target===e.currentTarget){var t=e.target.getBoundingClientRect(),a=t.top,o=t.left,i=t.bottom,r=t.right,s=[a+window.pageYOffset,o+window.pageXOffset,i+window.pageYOffset,r+window.pageXOffset];a=s[0],o=s[1],i=s[2],r=s[3];var c=e.clientX+window.pageXOffset,l=e.clientY+window.pageYOffset,h=[Math.ceil(l-a),Math.ceil(c-o)];o=h[1];var u=4*((a=h[0])*n.props.imageData.width+o);n.props.addColor({r:n.props.imageData.data[u],g:n.props.imageData.data[u+1],b:n.props.imageData.data[u+2]}),n.props.selectInstrument("pen")}},n}return Object(d.a)(t,e),Object(h.a)(t,[{key:"render",value:function(){return o.a.createElement("div",{className:"dropper",onClick:this.handleClick,style:{width:this.props.imageData.width,height:this.props.imageData.height}})}}]),t}(a.PureComponent),ee=Object(r.b)(function(e){return{imageData:e.image.data}},function(e){return{addColor:function(t){return e((n=t,function(e,t){for(var a=!1,o=JSON.stringify(n),i=0;i<t().colors.list.length;i++)if(JSON.stringify(t().colors.list[i])===o){a=i;break}e(!1===a?{type:K.ADD_COLOR,value:n}:Q(a))}));var n},selectInstrument:function(t){return e(k(t))}}})($),te=(n(45),function(e){function t(){var e,n;Object(l.a)(this,t);for(var o=arguments.length,i=new Array(o),r=0;r<o;r++)i[r]=arguments[r];(n=Object(u.a)(this,(e=Object(p.a)(t)).call.apply(e,[this].concat(i)))).handlePointerDown=function(e){var t;n.isDrawing=!0,n.drawPoint(),(t=n).beginDrawing.apply(t,Object(B.a)(b(n.canvasRef.current,e)))},n.handlePointerMove=function(e){var t=b(n.canvasRef.current,e),a=Object(G.a)(t,2),o=a[0],i=a[1];n.isDrawing&&3!==e.buttons&&n.continueDrawing(o,i),n.updateCanvas(o,i)},n.handlePointerEnter=function(e){var t;1===e.buttons&&n.isDrawing?(t=n).continueDrawing.apply(t,Object(B.a)(b(n.canvasRef.current,e))):n.isDrawing=!1},n.handlePointerLeave=function(e){var t;n.isDrawing&&(t=n).continueDrawing.apply(t,Object(B.a)(b(n.canvasRef.current,e)));n.updateCanvas()},n.handleDocumentPointerUp=function(){n.isDrawing&&(n.isDrawing=!1,n.endDrawing())},n.handleDocumentPointerMove=function(e){if(e.target!==n.canvasRef.current){var t=b(n.canvasRef.current,e),a=Object(G.a)(t,2);n.prevX=a[0],n.prevY=a[1]}n.isDrawing&&2===e.button&&(n.preventContextMenu=!0,n.cancelDrawing())},n.handleDocumentContextMenu=function(e){n.isDrawing&&(e.preventDefault(),n.isDrawing=!1)},n.handleDocumentSelectStart=function(e){n.isDrawing&&e.preventDefault()},n.beginDrawing=function(e,t){var a=n.props.color,o=a.r,i=a.g,r=a.b;n.ctx.fillStyle="rgb(".concat(o,",").concat(i,",").concat(r,")"),n.drawPoint(e,t);var s=[e,t];n.prevX=s[0],n.prevY=s[1]},n.continueDrawing=function(e,t){w(n.prevX,n.prevY,e,t,n.drawPoint);var a=[e,t];n.prevX=a[0],n.prevY=a[1]},n.endDrawing=function(){n.props.dispatch(L(n.noCursorCtx.getImageData(0,0,n.noCursorCtx.canvas.width,n.noCursorCtx.canvas.height)))},n.cancelDrawing=function(){n.noCursorCtx.putImageData(n.props.imageData,0,0)},n.drawPoint=function(e,t){n.noCursorCtx.fillRect(e-n.props.thickness/2,t-n.props.thickness/2,n.props.thickness,n.props.thickness)},n.updateCanvasNoCursor=function(){if(null!=n.props.imageData){var e=[n.props.imageData.width,n.props.imageData.height];n.noCursorCtx.canvas.width=e[0],n.noCursorCtx.canvas.height=e[1];var t=n.props.color,a=t.r,o=t.g,i=t.b;n.noCursorCtx.fillStyle="rgb(".concat(a,",").concat(o,",").concat(i,")"),n.noCursorCtx.putImageData(n.props.imageData,0,0)}},n.updateCanvas=function(e,t){n.ctx.drawImage(n.noCursorCtx.canvas,0,0),e&&t&&(n.ctx.fillRect(e-n.props.thickness/2,t-n.props.thickness/2,n.props.thickness,n.props.thickness),n.ctx.strokeRect(e-n.props.thickness/2+.5,t-n.props.thickness/2+.5,n.props.thickness-1,n.props.thickness-1))},n.canvasRef=Object(a.createRef)(),n.ctx=null;var s=document.createElement("canvas");return n.noCursorCtx=s.getContext("2d"),n.isDrawing=!1,n.prevX=0,n.prevY=0,n}return Object(d.a)(t,e),Object(h.a)(t,[{key:"render",value:function(){return o.a.createElement("canvas",{className:"eraser-canvas",ref:this.canvasRef,width:this.props.imageData?this.props.imageData.width:0,height:this.props.imageData?this.props.imageData.height:0,onPointerDown:this.handlePointerDown,onPointerUp:this.handlePointerUp,onPointerMove:this.handlePointerMove,onPointerEnter:this.handlePointerEnter,onPointerLeave:this.handlePointerLeave})}},{key:"componentDidMount",value:function(){this.ctx=this.canvasRef.current.getContext("2d");var e=this.props.color,t=e.r,n=e.g,a=e.b;this.ctx.fillStyle="rgb(".concat(t,",").concat(n,",").concat(a,")"),this.ctx.strokeStyle="black",this.noCursorCtx.fillStyle="rgb(".concat(t,",").concat(n,",").concat(a,")"),this.updateCanvasNoCursor(),document.addEventListener("pointerup",this.handleDocumentPointerUp),document.addEventListener("pointermove",this.handleDocumentPointerMove),document.addEventListener("selectstart",this.handleDocumentSelectStart),document.addEventListener("contextmenu",this.handleDocumentContextMenu)}},{key:"componentDidUpdate",value:function(){var e=this.props.color,t=e.r,n=e.g,a=e.b;this.ctx.fillStyle="rgb(".concat(t,",").concat(n,",").concat(a,")"),this.noCursorCtx.fillStyle="rgb(".concat(t,",").concat(n,",").concat(a,")"),this.updateCanvasNoCursor()}},{key:"componentWillUnmount",value:function(){document.removeEventListener("pointerup",this.handleDocumentPointerUp),document.removeEventListener("pointermove",this.handleDocumentPointerMove),document.removeEventListener("selectstart",this.handleDocumentSelectStart),document.removeEventListener("contextmenu",this.handleDocumentContextMenu)}}]),t}(a.PureComponent)),ne={pen:V,fill:q,selection:W,dropper:ee,eraser:Object(r.b)(function(e){return{color:e.colors.list[e.colors.secondary],imageData:e.image.data,thickness:8}})(te)},ae=function(e){function t(){return Object(l.a)(this,t),Object(u.a)(this,Object(p.a)(t).apply(this,arguments))}return Object(d.a)(t,e),Object(h.a)(t,[{key:"render",value:function(){var e=ne[this.props.instrument];return null!=e?o.a.createElement(e,null):null}}]),t}(a.PureComponent),oe=Object(r.b)(function(e){return{instrument:e.instruments.instrument}})(ae),ie=(n(46),function(e){function t(){var e,n;Object(l.a)(this,t);for(var o=arguments.length,i=new Array(o),r=0;r<o;r++)i[r]=arguments[r];return(n=Object(u.a)(this,(e=Object(p.a)(t)).call.apply(e,[this].concat(i)))).updateCanvas=function(){var e=n.canvas.current;if(null!=e&&null!=n.props.data){var t=[n.props.data.width,n.props.data.height];e.width=t[0],e.height=t[1],e.getContext("2d").putImageData(n.props.data,0,0)}},n.onResize=function(e,t,a,o){if(n.props.data.width!==a||n.props.data.height!==o){var i=document.createElement("canvas");i.width=a,i.height=o;var r=i.getContext("2d");r.fillStyle="rgb(".concat(n.props.secondaryColor.r,",").concat(n.props.secondaryColor.g,",").concat(n.props.secondaryColor.b,")"),r.fillRect(0,0,a,o),r.putImageData(n.props.data,0,0),n.props.changeImage(r.getImageData(0,0,a,o))}},n.canvas=Object(a.createRef)(),n}return Object(d.a)(t,e),Object(h.a)(t,[{key:"render",value:function(){return o.a.createElement("div",{className:"canvas-wrapper"},o.a.createElement("canvas",{ref:this.canvas,className:"canvas",width:this.props.data?this.props.data.width:0,height:this.props.data?this.props.data.height:0}),o.a.createElement("div",{className:"canvas-upper-layer",style:{width:this.props.data?this.props.data.width:0,height:this.props.data?this.props.data.height:0}},o.a.createElement(X,{mode:"canvas",onResizeEnd:this.onResize,onResizing:this.props.disableSelection,width:this.props.data?this.props.data.width:0,height:this.props.data?this.props.data.height:0,top:0,left:0}),o.a.createElement(oe,null)))}},{key:"componentDidMount",value:function(){this.updateCanvas()}},{key:"componentDidUpdate",value:function(){this.updateCanvas()}}]),t}(a.PureComponent)),re=Object(r.b)(function(e){return{data:e.image.data,secondaryColor:e.colors.list[e.colors.secondary]}},function(e){return{changeImage:function(t){return e(L(t))},disableSelection:function(){return e({type:z.CHANGE_INSTRUMENT,selection:{coords:null,imageData:null}})}}})(ie),se=(n(47),n(48),function(e){return o.a.createElement("section",{className:"navbar-item"},e.children,o.a.createElement("footer",null,e.footer))}),ce=function(e){function t(){return Object(l.a)(this,t),Object(u.a)(this,Object(p.a)(t).apply(this,arguments))}return Object(d.a)(t,e),Object(h.a)(t,[{key:"render",value:function(){return o.a.createElement("nav",{className:"navbar"},this.props.children.map(function(e,t){return o.a.createElement(se,{footer:e.props.footer,key:"navbaritem".concat(t)},e)}))}}]),t}(a.Component),le=(n(49),function(e){function t(){return Object(l.a)(this,t),Object(u.a)(this,Object(p.a)(t).apply(this,arguments))}return Object(d.a)(t,e),Object(h.a)(t,[{key:"render",value:function(){return o.a.createElement("nav",{className:"clipboard"},o.a.createElement("button",{disabled:!1},"\u0412\u044b\u0440\u0435\u0437\u0430\u0442\u044c"),o.a.createElement("button",{disabled:!1},"\u041a\u043e\u043f\u0438\u0440\u043e\u0432\u0430\u0442\u044c"),o.a.createElement("button",{disabled:!1},"\u0412\u0441\u0442\u0430\u0432\u0438\u0442\u044c"))}}]),t}(a.Component)),he=(n(50),function(e){function t(){var e,n;Object(l.a)(this,t);for(var a=arguments.length,o=new Array(a),i=0;i<a;i++)o[i]=arguments[i];return(n=Object(u.a)(this,(e=Object(p.a)(t)).call.apply(e,[this].concat(o)))).handleClick=function(){n.props.selectInstrument("selection")},n.handleClipClick=function(){if(n.props.selection&&n.props.selection.coords){var e=document.createElement("canvas"),t=e.getContext("2d"),a=n.props.selection.coords;e.width=a.width,e.height=a.height,t.putImageData(n.props.image,0,0),n.props.changeImage(t.getImageData(n.props.selection.coords.left,n.props.selection.coords.top,n.props.selection.coords.width,n.props.selection.coords.height)),n.props.selectInstrument("selection")}},n}return Object(d.a)(t,e),Object(h.a)(t,[{key:"render",value:function(){return o.a.createElement("nav",{className:"image"},o.a.createElement("button",{className:m()("select",{select_active:"selection"===this.props.instrument}),onClick:this.handleClick},o.a.createElement("svg",{viewBox:"0 0 15 10"},o.a.createElement("rect",{width:"15",height:"10",style:{fill:"transparent",strokeWidth:"1",strokeDasharray:"1",stroke:"black"}})),o.a.createElement("footer",null,"\u0412\u044b\u0434\u0435\u043b\u0438\u0442\u044c")),o.a.createElement("div",{className:"side-buttons"},o.a.createElement("button",{onClick:this.handleClipClick,disabled:!(this.props.selection&&this.props.selection.coords)},"\u041e\u0431\u0440\u0435\u0437\u0430\u0442\u044c"),o.a.createElement("button",null,"\u0418\u0437\u043c\u0435\u043d\u0438\u0442\u044c \u0440\u0430\u0437\u043c\u0435\u0440"),o.a.createElement("button",null,"\u041f\u043e\u0432\u0435\u0440\u043d\u0443\u0442\u044c")))}}]),t}(a.Component)),ue=Object(r.b)(function(e){return{image:e.image.data,instrument:e.instruments.instrument,selection:e.instruments.selection}},function(e){return{selectInstrument:function(t){return e(k(t))},changeImage:function(t){return e(L(t))}}})(he),pe=(n(51),["pen","fill","text","eraser","dropper","zoom"]),de=function(e){function t(){return Object(l.a)(this,t),Object(u.a)(this,Object(p.a)(t).apply(this,arguments))}return Object(d.a)(t,e),Object(h.a)(t,[{key:"render",value:function(){var e=this;return o.a.createElement("div",{className:"instruments"},pe.map(function(t){return o.a.createElement("button",{className:m()("instrument_".concat(t),{instrument_active:t===e.props.instrument}),key:"instrument_".concat(t),onClick:e.props.selectInstrument.bind(void 0,t)})}))}}]),t}(a.PureComponent),ge=Object(r.b)(function(e){return{instrument:e.instruments.instrument}},function(e){return{selectInstrument:function(t){return e(k(t))}}})(de),me=(n(52),n(53),function(e){return o.a.createElement("div",{className:"color-palette"},e.children)}),ve=(n(54),function(e){return o.a.createElement("div",{className:m()("color-selection",{"color-selection_active":e.active}),onClick:e.onClick},o.a.createElement("div",{className:"color-selection-color",style:{backgroundColor:"rgb(".concat(e.color.r,",").concat(e.color.g,",").concat(e.color.b,")")}}),o.a.createElement("h6",{className:"color-selection-header"},e.header))}),fe=(n(55),function(e){return o.a.createElement("div",{className:"color-input"},o.a.createElement("label",{className:"color-input-wrapper"},o.a.createElement("input",{type:"color",onChange:e.onChange,value:e.value})),o.a.createElement("h6",{className:"color-input-header"},"\u0418\u0437\u043c\u0435\u043d\u0435\u043d\u0438\u0435 \u0446\u0432\u0435\u0442\u043e\u0432"))}),Ce=(n(56),function(e){return o.a.createElement("div",{onClick:e.onClick,style:e.value&&{backgroundColor:"rgb(".concat(e.value.r,", ").concat(e.value.g,", ").concat(e.value.b,")")},className:m()("color",{color_active:e.active,color_undefined:!e.value})})}),we=function(e){return o.a.createElement("div",{className:"colors"},o.a.createElement(ve,{header:"\u0426\u0432\u0435\u0442 1",color:e.colors[e.primary],active:"primary"===e.activeColor,onClick:function(){return e.onActiveColorClick("primary")}}),o.a.createElement(ve,{header:"\u0426\u0432\u0435\u0442 2",color:e.colors[e.secondary],active:"secondary"===e.activeColor,onClick:function(){return e.onActiveColorClick("secondary")}}),o.a.createElement(me,null,[].concat(Object(B.a)(e.colors.map(function(t,n){return o.a.createElement(Ce,{value:t,active:n===e[e.activeColor],onClick:function(){return e.onColorClick(n)},key:"color"+n,colorId:n})})),Object(B.a)(new Array(30-e.colors.length).fill(void 0).map(function(e,t){return o.a.createElement(Ce,{value:null,key:"undefinedcolor"+t})})))),o.a.createElement(fe,{onChange:e.onColorInputChange,value:C(e.colors[e[e.activeColor]])}))},be=function(e){function t(){return Object(l.a)(this,t),Object(u.a)(this,Object(p.a)(t).apply(this,arguments))}return Object(d.a)(t,e),Object(h.a)(t,[{key:"render",value:function(){return o.a.createElement(we,this.props)}}]),t}(a.PureComponent),De=Object(r.b)(function(e){return{colors:e.colors.list,activeColor:e.colors.activeColor,primary:e.colors.primary,secondary:e.colors.secondary}},function(e){return{onColorClick:function(t){return e(Q(t))},onActiveColorClick:function(t){return e(function(e){return{type:K.CHANGE_ACTIVE_COLOR,activeColor:e}}(t))},onColorInputChange:function(t){return e(function(e){return function(t,n){for(var a=e.target.value.match(/[A-Za-z0-9]{2}/g).map(function(e){return parseInt(e,16)}),o={r:a[0],g:a[1],b:a[2]},i=JSON.stringify(o),r=!1,s=0;s<n().colors.list.length;s++)if(JSON.stringify(n().colors.list[s])===i){r=!0;break}r||t({type:K.ADD_COLOR,value:o})}}(t))}}})(be),Oe=function(){var e=arguments.length>0&&void 0!==arguments[0]?arguments[0]:{list:[{r:0,g:0,b:0},{r:127,g:127,b:127},{r:136,g:0,b:21},{r:237,g:28,b:36},{r:255,g:127,b:39},{r:255,g:242,b:0},{r:34,g:177,b:76},{r:0,g:162,b:232},{r:63,g:72,b:204},{r:163,g:73,b:164},{r:255,g:255,b:255},{r:195,g:195,b:195},{r:185,g:122,b:87},{r:255,g:174,b:201},{r:255,g:201,b:14},{r:239,g:228,b:176},{r:181,g:230,b:29},{r:153,g:217,b:234},{r:112,g:176,b:190},{r:200,g:191,b:231}],activeColor:"primary",primary:0,secondary:10},t=arguments.length>1?arguments[1]:void 0,n=Object(S.a)({},e);switch(t.type){case K.SELECT_COLOR:return n[n.activeColor]=t.index,n;case K.ADD_COLOR:return 30!==n.list.length?(n.list=[].concat(Object(B.a)(n.list),[t.value]),n[n.activeColor]=e.list.length):(n.list=[].concat(Object(B.a)(n.list.slice(0,20)),Object(B.a)(n.list.slice(21)),[t.value]),n[n.activeColor]=e.list.length-1),n;case K.CHANGE_ACTIVE_COLOR:return n.activeColor=t.activeColor,n;default:return e}},Ee=function(){var e=arguments.length>0&&void 0!==arguments[0]?arguments[0]:{instrument:"pen"},t=arguments.length>1?arguments[1]:void 0;switch(t.type){case z.CHANGE_INSTRUMENT:t.type;var n=Object(Y.a)(t,["type"]);return Object(S.a)({},e,n);default:return e}},ye=Object(s.c)({image:function(e,t){if(void 0===e){var n=document.createElement("canvas"),a=[800,450];n.width=a[0],n.height=a[1];var o=n.getContext("2d");return o.fillStyle="#FFFFFF",o.fillRect(0,0,n.width,n.height),{data:o.getImageData(0,0,n.width,n.height),name:"\u0412\u0430\u0448\u0430 \u043f\u0438\u043a\u0447\u0430.png"}}switch(t.type){case j.IMAGE_CHANGED:return{data:t.data,name:t.name||e.name};default:return e}},colors:Oe,instruments:Ee}),xe=function(e){function t(){return Object(l.a)(this,t),Object(u.a)(this,Object(p.a)(t).apply(this,arguments))}return Object(d.a)(t,e),Object(h.a)(t,[{key:"render",value:function(){var e=this;return o.a.createElement(o.a.Fragment,null,o.a.createElement(x,{onDownload:function(){return t=e.props.downloadName,void R.toBlob(function(e){null!==P&&window.URL.revokeObjectURL(P),P=window.URL.createObjectURL(e);var n=document.createElement("a");n.download=t,n.href=P,document.body.appendChild(n),n.click(),document.body.removeChild(n)});var t},onFileCreate:this.props.onFileCreate,onFileOpen:this.props.onFileOpen}),o.a.createElement(ce,null,o.a.createElement(le,{onPasteClick:this.props.onClipboardPasteClick,disabled:this.props.clipboardDisabled,footer:"\u0411\u0443\u0444\u0435\u0440 \u043e\u0431\u043c\u0435\u043d\u0430"}),o.a.createElement(ue,{footer:"\u0418\u0437\u043e\u0431\u0440\u0430\u0436\u0435\u043d\u0438\u0435"}),o.a.createElement(ge,{footer:"\u0418\u043d\u0441\u0442\u0440\u0443\u043c\u0435\u043d\u0442\u044b"}),o.a.createElement(De,{footer:"\u0426\u0432\u0435\u0442\u0430"})),o.a.createElement(re,{onCanvasRef:this.handleCanvasRef}))}},{key:"componentDidMount",value:function(){document.addEventListener("paste",this.props.onPaste)}},{key:"componentWillUnmount",value:function(){document.removeEventListener("paste",this.props.onPaste)}}]),t}(a.PureComponent),ze=Object(r.b)(function(e){return{downloadName:e.image.name}},function(e){return{onFileCreate:function(){return e(I())},onFileOpen:function(t){return e(function(e){return function(t,n){var a=e.nativeEvent.target.files[0];if(null!=a){var o=new FileReader;o.onload=function(e){var n=new Image;n.onload=function(){R.width=n.width,R.height=n.height,M.drawImage(n,0,0),t({type:j.IMAGE_CHANGED,data:M.getImageData(0,0,n.width,n.height),name:a.name})},n.src=e.target.result},o.readAsDataURL(a)}}}(t))},onPaste:function(t){return e(function(e){return function(t,n){if(e.clipboardData){var a=e.clipboardData.items;if(!a)return;for(var o=0;o<a.length&&(-1===a[o].type.indexOf("image")||"break"!==function(){var e=a[o].getAsFile(),n=window.URL.createObjectURL(e),i=new Image;return i.onload=function(){var e=document.createElement("canvas");e.width=i.width,e.height=i.height;var n=e.getContext("2d");n.drawImage(i,0,0),t({type:z.CHANGE_INSTRUMENT,instrument:"selection",selection:{imageData:n.getImageData(0,0,e.width,e.height),coords:{top:0,left:0,width:i.width,height:i.height}}})},i.src=n,"break"}());o++);e.preventDefault()}}}(t))}}})(xe),ke=window.__REDUX_DEVTOOLS_EXTENSION_COMPOSE__||s.d,je=Object(s.e)(ye,ke(Object(s.a)(c.a)));Object(i.render)(o.a.createElement(a.StrictMode,null,o.a.createElement(r.a,{store:je},o.a.createElement(ze,null))),document.getElementById("root"))}]),[[25,1,2]]]);
//# sourceMappingURL=main.52eceffb.chunk.js.map